<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="2601547">
<meta name="dcterms.date" content="2025-05-02">
<meta name="keywords" content="Commuting flows, Socio-economic factors, Regional disparities, Transport policy, Machine learning, Statistical modelling, Local authorities">

<title>What drives commuting decisions?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6e5ff12f349f7d7ee99023e5a7f49be9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="citation_title" content="What drives commuting decisions?">
<meta name="citation_abstract" content="This study answers, “which structural socio-economic factors between regions most influence the relative popularity of commuting routes?” This question is important as transport policy, development planning and wider government initiatives such as the “Levelling Up” agenda are all influenced by commuting patterns. The analysis uses a dataset of commuting flows between local authorities in England. It employs statistical and machine learning techniques (such as OLS, SEM and Random Forest) to identify the most significant factors influencing commuting decisions. The study finds that across all methods, distance is the most important factor influencing commuting flows, generally followed by population, median pay and housing growth differences between local authorities. The study also finds that the relative importance of these factors varies by region, with spatial aspects playing a key role in the influence of different factors.
">
<meta name="citation_keywords" content="Commuting flows,Socio-economic factors,Regional disparities,Transport policy,Machine learning,Statistical modelling,Local authorities">
<meta name="citation_author" content="2601547 ">
<meta name="citation_publication_date" content="2025-05-02">
<meta name="citation_cover_date" content="2025-05-02">
<meta name="citation_year" content="2025">
<meta name="citation_online_date" content="2025-05-02">
<meta name="citation_language" content="en">
<meta name="citation_journal_title" content="GEOGM0053: Data Science and Machine Learning">
<meta name="citation_reference" content="citation_title=Do rising rents lead to longer commutes? A gravity model of commuting flows in Ireland;,citation_abstract=The classical monocentric city model suggests that property prices decrease and transport costs rise with distance to the urban centre, implying that employees face a trade-off between long commutes and high housing costs when making location decisions. Accordingly, some commuters might be forced to take on longer commutes due to rising rents in central locations. In this study, we investigate empirically whether the rental differential between employment centres and residential areas predicts changes in average commuting times. To this end, we consider a gravity model of commuting flows for Ireland over 2011–2016. We present results for Ireland and the metropolitan area of Dublin, which constitutes the largest commuting region in Ireland. The results imply that a 10% rise in rents in employment centres is associated with an up to 0.6 minute rise in one-way daily average commuting times nationally (about 2.2% of the average commute duration).;,citation_author=Achim Ahrens;,citation_author=Sean Lyons;,citation_publication_date=2021-02;,citation_cover_date=2021-02;,citation_year=2021;,citation_fulltext_html_url=https://journals.sagepub.com/doi/10.1177/0042098020910698;,citation_issue=2;,citation_doi=10.1177/0042098020910698;,citation_issn=0042-0980, 1360-063X;,citation_volume=58;,citation_journal_title=Urban Studies;">
<meta name="citation_reference" content="citation_title=The Effects of Housing Prices, Wages, and Commuting Time on Joint Residential and Job Location Choices;,citation_abstract=Abstract An empirical model of joint decisions of where to live and where to work demonstrates that individuals make residential and job location choices by trading off wages, housing prices, and commuting costs. Wages are higher in metropolitan markets, but housing prices are also higher in urban areas. Consumers can live in lower priced nonmetropolitan houses and still earn urban wages, but they incur commuting costs that increase with distance from the city. Improvements in transportation that lower commuting time will increase nonmetropolitan populations and will increase the number of nonmetropolitan commuters to metropolitan markets. Equal wage growth across labor markets causes a shift in relative population from rural to urban markets, while an equiproportional increase in housing prices causes a population shift toward rural areas.;,citation_author=Kim S. So;,citation_author=Peter F. Orazem;,citation_author=Daniel M. Otto;,citation_publication_date=2001-11;,citation_cover_date=2001-11;,citation_year=2001;,citation_fulltext_html_url=https://onlinelibrary.wiley.com/doi/10.1111/0002-9092.00228;,citation_issue=4;,citation_doi=10.1111/0002-9092.00228;,citation_issn=0002-9092, 1467-8276;,citation_volume=83;,citation_journal_title=American Journal of Agricultural Economics;">
<meta name="citation_reference" content="citation_title=Is housing affordability associated with shorter commutes for low-income workers?;,citation_author=Evelyn Blumenberg Madeline Wander;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://escholarship.org/uc/item/6cg12850;,citation_doi=10.17610/T6Z32J;">
<meta name="citation_reference" content="citation_title=International Migration: A Global Complex Network;,citation_abstract=Migration has become a prominent research theme in geography and regional science and it has been approached from various methodological angles. Nonetheless, a common missing element in most migration studies is the lack of awareness of the overall network topology, which characterizes migration flows. Although gravity models focus on spatial interaction—in this case migration—between pairs of origins and destinations, they do not provide insights into the topology of a migration network. We employ network analysis to address such systemic research questions, in particular: how centralized or dispersed are migration flows and how does this structure evolve over time? And, how is migration activity clustered between specific countries, and if it is clustered, do such patterns change over time? Going a step further than exploratory network analysis, in this paper we estimate international migration models for OECD countries based on a dual approach: gravity models estimated using conventional econometric approaches such as panel data regressions and network-based regression techniques such as multivariate regression quadratic assignment procedures. The empirical results reveal not only the determinants of international migration among OECD countries, but also the value of blending network analysis with more conventional analytic methods.;,citation_author=Emmanouil Tranos;,citation_author=Masood Gheasi;,citation_author=Peter Nijkamp;,citation_publication_date=2015-02;,citation_cover_date=2015-02;,citation_year=2015;,citation_fulltext_html_url=https://journals.sagepub.com/doi/10.1068/b39042;,citation_issue=1;,citation_doi=10.1068/b39042;,citation_issn=0265-8135, 1472-3417;,citation_volume=42;,citation_journal_title=Environment and Planning B: Planning and Design;">
<meta name="citation_reference" content="citation_title=A new geodemographic classification of commuting flows for England and Wales;,citation_abstract=This paper aims to contribute to the area of geodemographic research through the development of a new and novel ﬂow-based classiﬁcation of commuting for England and Wales. In doing so, it applies an approach to the analysis of commuting in which origin-destination ﬂow-data, collected as part of the 2011 census of England and Wales, are segmented into groups based on shared similarities across multiple demographic and socioeconomic attributes. k-Means clustering was applied to 49 ﬂow-based commuter variables for 513,892 interactions that captured 18.4 million of the 26.5 million workers recorded as part of the 2011 census of England and Wales. The ﬁnal classiﬁcation resulted in an upper-tier of nine “Supergroups” which were subsequently partitioned to derive a lower-tier of 40 “Groups”. A nomenclature was developed and associated pen portraits derived to provide basic signposting to the dominant characteristics of each cluster. Analysis of a selection of patterns underlying the ninefold Supergroup conﬁguration revealed a highly variegated structure of commuting in England and Wales. The classiﬁcation has potentially wide-ranging descriptive and analytical applications within research and policy domains and the approach would be equally transferable to other countries and contexts where origin-destination data are disaggregated based on commuter characteristics.;,citation_author=Stephen Hincks;,citation_author=Richard Kingston;,citation_author=Brian Webb;,citation_author=Cecilia Wong;,citation_publication_date=2018-04;,citation_cover_date=2018-04;,citation_year=2018;,citation_fulltext_html_url=https://www.tandfonline.com/doi/full/10.1080/13658816.2017.1407416;,citation_issue=4;,citation_doi=10.1080/13658816.2017.1407416;,citation_issn=1365-8816, 1362-3087;,citation_volume=32;,citation_journal_title=International Journal of Geographical Information Science;">
<meta name="citation_reference" content="citation_title=A new family of power transformations to improve normality or symmetry;,citation_abstract=We introduce a new power transformation family which is well defined on the whole real line and which is appropriate for reducing skewness and to approximate normality. It has properties similar to those of the Box-Cox transformation for positive variables. The large-sample properties of the transformation are investigated in the contect of a single random sample.;,citation_author=I.-K. Yeo;,citation_publication_date=2000-12;,citation_cover_date=2000-12;,citation_year=2000;,citation_fulltext_html_url=https://academic.oup.com/biomet/article-lookup/doi/10.1093/biomet/87.4.954;,citation_issue=4;,citation_doi=10.1093/biomet/87.4.954;,citation_issn=0006-3444, 1464-3510;,citation_volume=87;,citation_journal_title=Biometrika;">
</head>

<body class="quarto-light">

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">What drives commuting decisions?</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Author</div>
          <div class="quarto-title-meta-heading">Affiliation</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">2601547 <a href="mailto:2601547@protonmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        University of Bristol
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">May 2, 2025</p>
            </div>
          </div>
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      <div class="quarto-alternate-formats"><div class="quarto-title-meta-heading">Other Formats</div><div class="quarto-title-meta-contents"><p><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF (elsevier)</a></p></div><div class="quarto-title-meta-contents"><p><a href="index.docx"><i class="bi bi-file-word"></i>MS Word</a></p></div></div></div>
    </div>

    <div>
      <div class="abstract">
        <div class="block-title">Abstract</div>
        <p>This study answers, “which structural socio-economic factors between regions most influence the relative popularity of commuting routes?” This question is important as transport policy, development planning and wider government initiatives such as the “Levelling Up” agenda are all influenced by commuting patterns. The analysis uses a dataset of commuting flows between local authorities in England. It employs statistical and machine learning techniques (such as OLS, SEM and Random Forest) to identify the most significant factors influencing commuting decisions. The study finds that across all methods, distance is the most important factor influencing commuting flows, generally followed by population, median pay and housing growth differences between local authorities. The study also finds that the relative importance of these factors varies by region, with spatial aspects playing a key role in the influence of different factors.</p>
      </div>
    </div>

    <div>
      <div class="keywords">
        <div class="block-title">Keywords</div>
        <p>Commuting flows, Socio-economic factors, Regional disparities, Transport policy, Machine learning, Statistical modelling, Local authorities</p>
      </div>
    </div>

    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-research-question" id="toc-sec-research-question" class="nav-link active" data-scroll-target="#sec-research-question"><span class="header-section-number">1</span> Research Question</a></li>
  <li><a href="#sec-inferential-design" id="toc-sec-inferential-design" class="nav-link" data-scroll-target="#sec-inferential-design"><span class="header-section-number">2</span> Inferential Design</a>
  <ul class="collapse">
  <li><a href="#sec-data-refinement" id="toc-sec-data-refinement" class="nav-link" data-scroll-target="#sec-data-refinement"><span class="header-section-number">2.1</span> Data Refinement</a></li>
  <li><a href="#sec-feature-additions" id="toc-sec-feature-additions" class="nav-link" data-scroll-target="#sec-feature-additions"><span class="header-section-number">2.2</span> Feature Additions</a>
  <ul class="collapse">
  <li><a href="#sec-geometry" id="toc-sec-geometry" class="nav-link" data-scroll-target="#sec-geometry"><span class="header-section-number">2.2.1</span> Geometry</a></li>
  <li><a href="#sec-centrality" id="toc-sec-centrality" class="nav-link" data-scroll-target="#sec-centrality"><span class="header-section-number">2.2.2</span> Centrality</a></li>
  <li><a href="#sec-accomodation-rental-cost" id="toc-sec-accomodation-rental-cost" class="nav-link" data-scroll-target="#sec-accomodation-rental-cost"><span class="header-section-number">2.2.3</span> Accommodation Rental Cost</a></li>
  </ul></li>
  <li><a href="#sec-data-aggregation" id="toc-sec-data-aggregation" class="nav-link" data-scroll-target="#sec-data-aggregation"><span class="header-section-number">2.3</span> Data Aggregation</a>
  <ul class="collapse">
  <li><a href="#sec-paired-data" id="toc-sec-paired-data" class="nav-link" data-scroll-target="#sec-paired-data"><span class="header-section-number">2.3.1</span> Addressing Paired Data</a></li>
  <li><a href="#sec-calculating-differences" id="toc-sec-calculating-differences" class="nav-link" data-scroll-target="#sec-calculating-differences"><span class="header-section-number">2.3.2</span> Calculating Differences</a></li>
  <li><a href="#sec-removing-pairs" id="toc-sec-removing-pairs" class="nav-link" data-scroll-target="#sec-removing-pairs"><span class="header-section-number">2.3.3</span> Removing Pairs</a></li>
  </ul></li>
  <li><a href="#sec-feature-transformations" id="toc-sec-feature-transformations" class="nav-link" data-scroll-target="#sec-feature-transformations"><span class="header-section-number">2.4</span> Feature Transformations</a></li>
  </ul></li>
  <li><a href="#sec-linear-regression" id="toc-sec-linear-regression" class="nav-link" data-scroll-target="#sec-linear-regression"><span class="header-section-number">3</span> Linear Regression (OLS and SEM)</a>
  <ul class="collapse">
  <li><a href="#sec-simple-linear-regression" id="toc-sec-simple-linear-regression" class="nav-link" data-scroll-target="#sec-simple-linear-regression"><span class="header-section-number">3.1</span> Simple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#sec-interpretation-ols-1" id="toc-sec-interpretation-ols-1" class="nav-link" data-scroll-target="#sec-interpretation-ols-1"><span class="header-section-number">3.1.1</span> Interpretation of the OLS results</a></li>
  <li><a href="#sec-discussion-ols-1" id="toc-sec-discussion-ols-1" class="nav-link" data-scroll-target="#sec-discussion-ols-1"><span class="header-section-number">3.1.2</span> Discussion</a></li>
  <li><a href="#sec-multicollinearity-ols-1" id="toc-sec-multicollinearity-ols-1" class="nav-link" data-scroll-target="#sec-multicollinearity-ols-1"><span class="header-section-number">3.1.3</span> Multicollinearity</a></li>
  </ul></li>
  <li><a href="#sec-refined-linear-regression" id="toc-sec-refined-linear-regression" class="nav-link" data-scroll-target="#sec-refined-linear-regression"><span class="header-section-number">3.2</span> Refined Linear Regression</a>
  <ul class="collapse">
  <li><a href="#sec-interpretation-ols-2" id="toc-sec-interpretation-ols-2" class="nav-link" data-scroll-target="#sec-interpretation-ols-2"><span class="header-section-number">3.2.1</span> Interpretation of the OLS results</a></li>
  <li><a href="#sec-multicollinearity-ols-2" id="toc-sec-multicollinearity-ols-2" class="nav-link" data-scroll-target="#sec-multicollinearity-ols-2"><span class="header-section-number">3.2.2</span> Multicollinearity</a></li>
  <li><a href="#sec-discussion-ols-2" id="toc-sec-discussion-ols-2" class="nav-link" data-scroll-target="#sec-discussion-ols-2"><span class="header-section-number">3.2.3</span> Discussion</a></li>
  </ul></li>
  <li><a href="#sec-sem" id="toc-sec-sem" class="nav-link" data-scroll-target="#sec-sem"><span class="header-section-number">3.3</span> Spatial Error Model (SEM)</a>
  <ul class="collapse">
  <li><a href="#sec-interpretation-sem" id="toc-sec-interpretation-sem" class="nav-link" data-scroll-target="#sec-interpretation-sem"><span class="header-section-number">3.3.1</span> Interpretation of the SEM results</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-random-forest" id="toc-sec-random-forest" class="nav-link" data-scroll-target="#sec-random-forest"><span class="header-section-number">4</span> Random Forest</a></li>
  <li><a href="#sec-conclusion" id="toc-sec-conclusion" class="nav-link" data-scroll-target="#sec-conclusion"><span class="header-section-number">5</span> Conclusion</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  <li><a href="#sec-appendices" id="toc-sec-appendices" class="nav-link" data-scroll-target="#sec-appendices"><span class="header-section-number">6</span> Appendices</a>
  <ul class="collapse">
  <li><a href="#sec-setup" id="toc-sec-setup" class="nav-link" data-scroll-target="#sec-setup"><span class="header-section-number">6.1</span> Appendix A: Setup</a>
  <ul class="collapse">
  <li><a href="#sec-environment" id="toc-sec-environment" class="nav-link" data-scroll-target="#sec-environment"><span class="header-section-number">6.1.1</span> Environment</a></li>
  <li><a href="#sec-packages" id="toc-sec-packages" class="nav-link" data-scroll-target="#sec-packages"><span class="header-section-number">6.1.2</span> Packages</a></li>
  </ul></li>
  <li><a href="#sec-eda" id="toc-sec-eda" class="nav-link" data-scroll-target="#sec-eda"><span class="header-section-number">6.2</span> Appendix B: Exploratory Data Analysis</a></li>
  <li><a href="#sec-centrality-appendix" id="toc-sec-centrality-appendix" class="nav-link" data-scroll-target="#sec-centrality-appendix"><span class="header-section-number">6.3</span> Appendix C: Centrality</a></li>
  <li><a href="#sec-data-diagnostics" id="toc-sec-data-diagnostics" class="nav-link" data-scroll-target="#sec-data-diagnostics"><span class="header-section-number">6.4</span> Appendix D: Data Diagnostics</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-notebooks"><h2>Notebooks</h2><ul><li><a href="index-preview.html"><i class="bi bi-journal-code"></i>Article Notebook</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">



  


<section id="sec-research-question" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Research Question</h1>
<p>The question asks, “what factors are influential in driving commuting decisions?” The provided dataset includes daily commuting data between local authorities (LAs) in England over the course of 2019. <code>'journey_score,</code>’ the key candidate for the dependent variable, represents the popularity of each route.</p>
<p>As with all inferential tasks, there are multiple paths to understanding and addressing the question. &nbsp;The dataset is daily, and <code>'journey_score'</code> varies daily per route. The <code>'journey_score'</code> appears standardised, i.e.&nbsp;popularity is relative to other routes. However, the variables are point in time, i.e.&nbsp;constant over the year, mainly focusing on socio-economic aspects of regions.</p>
<p>To me, this would imply that rather than looking at individual daily trips, which may be influenced by variables such as weather, sickness outbreaks across regions, fuel prices, etc., we are looking to identify more structural differences between regions.</p>
<p>Therefore, the research question I intend to answer is:</p>
<h5 style="margin-top: 30px; margin-bottom: 30px; font-style: italic;" class="anchored" data-anchor-id="sec-research-question">
“Which structural socio-economic factors between regions most influence the relative popularity of commuting routes?”
</h5>
<p>This research question is not the only way to interpret this task, and it will, in turn, directly influence the decisions I intend to make for inferential design. For example, aggregating daily data over the year per route may be more appropriate than using the current daily set, as structural socio-economic factors such as average wages do not vary materially over the course of a week or month.</p>
<p>The submission is structured to focus on the key aspects of statistical inference and analytics. Code is included where helpful to explain the process, and excluded where not, however complete code can be found in the ‘Article Notebook’. Some elements of the process, such as explanatory data analysis, are found in the appendices and referenced throughout the submission. Each section summarises the key points, and a conclusion is provided at the end of the submission.</p>
</section>
<section id="sec-inferential-design" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Inferential Design</h1>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Section Summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li><p>A cleaned version of the dataset is loaded in</p></li>
<li><p><strong>Data Refinement:</strong></p>
<ul>
<li>The dataset is refined for the research question by dropping:
<ul>
<li>Routes with the same origin and destination</li>
<li>Days of the year which are non-typical for commuting (i.e.&nbsp;unrepresentative data in terms of the research question)
<ul>
<li>Weekends</li>
<li>Bank Holidays</li>
</ul></li>
</ul></li>
</ul></li>
<li><p><strong>Feature Additions:</strong></p>
<ul>
<li>Geospatial and rent cost features are added to the dataset to reduce omitted-variable bias (OVB) and improve model performance</li>
</ul></li>
<li><p><strong>Data Aggregation:</strong></p>
<ul>
<li>Absolute differences for each variable are calculated between the two local authorities for each route</li>
<li>The dataset is aggregated to one row per route, per local authority pair, per year</li>
</ul></li>
<li><p><strong>Feature Transformations:</strong></p>
<ul>
<li>Skewness is identified in the data</li>
<li>Discussion around addressing this depends on the model used</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This code follows a setup (<a href="#sec-setup" class="quarto-xref">Appendix A - Setup: Section&nbsp;6.1</a>) and preliminary exploratory analysis of the data (<a href="#sec-eda" class="quarto-xref">Appendix B - EDA: Section&nbsp;6.2</a>) in the Appendices.</p>
<p>The code in this section is intended to be run independently following that setup with the cleaned dataset, which can be downloaded from the <a href="https://github.com/2601547/commute">Github project repo</a>. However, the library installations must be first run and can be found in the <a href="#sec-packages" class="quarto-xref">Appendix A - Packages: Section&nbsp;6.1.2</a> section.</p>
<p>To run independently from the original dataset, it is important to follow the step-by-step process in the <a href="#sec-appendices" class="quarto-xref">Appendices: Section&nbsp;6</a> section, that precedes this section in terms of the running order.</p>
</div>
</div>
</div>
<p>The cleaned (achieved in the <a href="#sec-appendices" class="quarto-xref">Appendices: Section&nbsp;6</a>) dataset is loaded in:</p>
<div id="cell-9" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>base_data_dir <span class="op">=</span> os.path.abspath(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'../../1. Data/LAcommute'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> pd.read_csv(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    os.path.join(base_data_dir, <span class="st">"LAcommute_clean.csv"</span>), index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>commute</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_code_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">area_code_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">gcse_rate_origin</th>
<th data-quarto-table-cell-role="th">life_satisfaction_origin</th>
<th data-quarto-table-cell-role="th">housing_growth_origin</th>
<th data-quarto-table-cell-role="th">value_added_hourly_dest</th>
<th data-quarto-table-cell-role="th">median_weekly_pay_dest</th>
<th data-quarto-table-cell-role="th">emp_rate_dest</th>
<th data-quarto-table-cell-role="th">travel_time_dest</th>
<th data-quarto-table-cell-role="th">gcse_rate_dest</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2019-01-01</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>1.4414</td>
<td>9</td>
<td>0.000000</td>
<td>92401</td>
<td>92401</td>
<td>...</td>
<td>67.6</td>
<td>7.33</td>
<td>161</td>
<td>28.31</td>
<td>487.4</td>
<td>67.1</td>
<td>12.9</td>
<td>67.6</td>
<td>7.33</td>
<td>161</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-01</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>County Durham</td>
<td>E06000047</td>
<td>-0.3129</td>
<td>3</td>
<td>37592.170378</td>
<td>92401</td>
<td>518562</td>
<td>...</td>
<td>67.6</td>
<td>7.33</td>
<td>161</td>
<td>28.96</td>
<td>469.4</td>
<td>71.4</td>
<td>14.1</td>
<td>67.6</td>
<td>7.43</td>
<td>1343</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>1.0253</td>
<td>10</td>
<td>0.000000</td>
<td>142134</td>
<td>142134</td>
<td>...</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
<td>29.30</td>
<td>420.8</td>
<td>65.6</td>
<td>15.4</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Redcar and Cleveland</td>
<td>E06000003</td>
<td>0.3086</td>
<td>7</td>
<td>13069.176565</td>
<td>142134</td>
<td>136699</td>
<td>...</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
<td>26.54</td>
<td>439.2</td>
<td>68.4</td>
<td>13.3</td>
<td>69.6</td>
<td>7.44</td>
<td>365</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Stockton-on-Tees</td>
<td>E06000004</td>
<td>0.3772</td>
<td>8</td>
<td>7379.212731</td>
<td>142134</td>
<td>196860</td>
<td>...</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
<td>34.37</td>
<td>469.4</td>
<td>74.8</td>
<td>13.2</td>
<td>69.5</td>
<td>7.40</td>
<td>616</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">301022</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Sutton</td>
<td>E09000029</td>
<td>-0.6732</td>
<td>4</td>
<td>16964.439602</td>
<td>208415</td>
<td>208516</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>35.19</td>
<td>565.8</td>
<td>77.4</td>
<td>9.0</td>
<td>82.0</td>
<td>7.36</td>
<td>313</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">301023</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Tower Hamlets</td>
<td>E09000030</td>
<td>1.3720</td>
<td>10</td>
<td>8616.142460</td>
<td>208415</td>
<td>305066</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>60.46</td>
<td>680.3</td>
<td>74.4</td>
<td>4.4</td>
<td>72.4</td>
<td>7.13</td>
<td>3248</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">301024</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Waltham Forest</td>
<td>E09000031</td>
<td>-0.4483</td>
<td>6</td>
<td>13672.865893</td>
<td>208415</td>
<td>281015</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>34.63</td>
<td>624.7</td>
<td>71.5</td>
<td>7.2</td>
<td>71.5</td>
<td>7.30</td>
<td>1263</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">301025</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Wandsworth</td>
<td>E09000032</td>
<td>0.1871</td>
<td>8</td>
<td>7117.584240</td>
<td>208415</td>
<td>334558</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>35.15</td>
<td>746.7</td>
<td>84.9</td>
<td>6.2</td>
<td>74.2</td>
<td>7.34</td>
<td>1415</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">301026</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Westminster</td>
<td>E09000033</td>
<td>1.6534</td>
<td>10</td>
<td>0.000000</td>
<td>208415</td>
<td>208415</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>52.46</td>
<td>771.6</td>
<td>67.2</td>
<td>5.1</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
</tr>
</tbody>
</table>

<p>301027 rows × 24 columns</p>
</div>
</div>
<a class="quarto-notebook-link" id="nblink-1" href="index-preview.html#cell-9">Source: Article Notebook</a></div>
<p>The cleaned dataset removes all routes with missing values e.g.&nbsp;“City of London” and “Isles of Scilly”. The full list of columns / variables can be seen below:</p>
<div id="cell-11" class="cell" data-execution_count="29">
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>Index(['date', 'area_name_origin', 'area_code_origin', 'area_name_dest',
       'area_code_dest', 'journey_score', 'journey_count_decile', 'distance',
       'population_origin', 'population_dest', 'value_added_hourly_origin',
       'median_weekly_pay_origin', 'emp_rate_origin', 'travel_time_origin',
       'gcse_rate_origin', 'life_satisfaction_origin', 'housing_growth_origin',
       'value_added_hourly_dest', 'median_weekly_pay_dest', 'emp_rate_dest',
       'travel_time_dest', 'gcse_rate_dest', 'life_satisfaction_dest',
       'housing_growth_dest'],
      dtype='object')</code></pre>
</div>
</div>
<section id="sec-data-refinement" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-data-refinement"><span class="header-section-number">2.1</span> Data Refinement</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subsection Summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>The dataset is refined for the reserach quesion by dropping:
<ul>
<li>Routes with the same origin and destination</li>
<li>Days of the year which are non-typical for commuting (i.e.&nbsp;unrepresentative data in terms of the research question)
<ul>
<li>Weekends</li>
<li>Bank Holidays</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>My research question focuses on the structural differences between regions, and therefore, I will be using one <code>'journey_score'</code> per route, per local authority pair. This can also be achieved in multiple ways (e.g.&nbsp;taking data for each route for one day only, averaging over some time, etc.). I will use the average over the year, as I believe this is the most representative of the structural differences between regions and allows full use of the dataset. This also avoids any potential bias from seasonal effects (such as holidays), weather, or other temporal factors and instead smoothes out the data.</p>
<p>To aggregate this way, I will need to remove any data that is not representative of structural commuting route popularity. This includes removing days that are not typical for commuting, such as weekends and bank holidays.</p>
<ul>
<li>Weekends are not typical for commuting as most people do not work and therefore commute on weekend</li>
<li>Bank holidays are not typical for commuting as most people do not work on bank holidays</li>
</ul>
<p>One of the advantages of using the average over the year instead of a smaller subset is that these effects are minimised. However, it is still important to consider this potential source of bias in the data and remove it, as I want the model to be as representative as possible to get stronger confidence in the inference.</p>
<p>I drop all rows where there are weekends:</p>
<div id="cell-16" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>commute[<span class="st">'date'</span>] <span class="op">=</span> commute[<span class="st">'date'</span>].<span class="bu">apply</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    pd.to_datetime, <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> commute[commute[<span class="st">'date'</span>].dt.dayofweek <span class="op">&lt;</span> <span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pull bank holidays from the <a href="https://www.gov.uk/bank-holidays.json">UK Government’s Bank Holiday API</a>, and drops all rows where the date is a bank holiday:</p>
<div id="cell-18" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://www.gov.uk/bank-holidays.json'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>gov_uk_bank_holdadays <span class="op">=</span> response.json()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>eng_wales_holidays <span class="op">=</span> gov_uk_bank_holdadays[<span class="st">'england-and-wales'</span>][<span class="st">'events'</span>] <span class="co"># filter to england and wales...</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>bank_holidays <span class="op">=</span> [pd.to_datetime(event[<span class="st">'date'</span>]) <span class="cf">for</span> event <span class="kw">in</span> eng_wales_holidays <span class="cf">if</span> <span class="st">'2019'</span> <span class="kw">in</span> event[<span class="st">'date'</span>]] <span class="co"># ... in 2019</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> commute[<span class="op">~</span>commute[<span class="st">'date'</span>].isin(bank_holidays)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, there are routes in the dataset where the origin and destination are the same. These can easily be identified when <code>'distance' = 0</code> and capture employees commuting within the same local authority.</p>
<p>Since the research question is focused on regional socio-economic structural differences, these are irrelevant as there are no differences for intra-regional commuting. These routes are, therefore, dropped:</p>
<div id="cell-20" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> commute[commute[<span class="st">'distance'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-feature-additions" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="sec-feature-additions"><span class="header-section-number">2.2</span> Feature Additions</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subsection Summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Geospatial, centrality and rent cost features are added to the dataset to reduce omitted-variable bias (OVB) and improve model performance</li>
</ul>
</div>
</div>
</div>
<p>The dataset provided is largely complete, however, omitted-variable bias (OVB) is a key concern in any inferential task and so additional features I believe may be useful are added. These are:</p>
<ul>
<li>Coordinates of the local authorities</li>
<li>A centrality measure</li>
<li>Accommodation rental costs</li>
</ul>
<p>Once multicollinearity is assessed, these may need to be removed.</p>
<section id="sec-geometry" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="sec-geometry"><span class="header-section-number">2.2.1</span> Geometry</h3>
<p>LAs are regional by definition. Therefore, geospatial relationships may need to be considered, and coordinates are added to the dataset accordingly.</p>
<p>The coordinates for the LA can be found in the <a href="https://geoportal.statistics.gov.uk/datasets/9cb3c710143649499ff6acaca927d205_0/explore">government depo</a>, and is downloaded as the file <code>"LAD_Dec_2019_Boundaries_UK_BFC_2022_-5126023737554987305.csv"</code>.</p>
<div id="cell-26" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>LA_coordinates <span class="op">=</span> pd.read_csv(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    os.path.join(base_data_dir, <span class="st">"LAD_Dec_2019_Boundaries_UK_BFC_2022_-5126023737554987305.csv"</span>), index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>LA_coordinates.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">objectid</th>
<th data-quarto-table-cell-role="th">lad19cd</th>
<th data-quarto-table-cell-role="th">lad19nm</th>
<th data-quarto-table-cell-role="th">lad19nmw</th>
<th data-quarto-table-cell-role="th">bng_e</th>
<th data-quarto-table-cell-role="th">bng_n</th>
<th data-quarto-table-cell-role="th">long</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">st_areasha</th>
<th data-quarto-table-cell-role="th">st_lengths</th>
<th data-quarto-table-cell-role="th">Shape__Area</th>
<th data-quarto-table-cell-role="th">Shape__Length</th>
<th data-quarto-table-cell-role="th">GlobalID</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">FID</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>E06000001</td>
<td>Hartlepool</td>
<td></td>
<td>447160</td>
<td>531474</td>
<td>-1.27018</td>
<td>54.67614</td>
<td>9.371262e+07</td>
<td>71011.933949</td>
<td>2.797890e+08</td>
<td>122680.152623</td>
<td>d3127426-63c8-4358-a554-b3fe4f0e537e</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>E06000002</td>
<td>Middlesbrough</td>
<td></td>
<td>451141</td>
<td>516887</td>
<td>-1.21099</td>
<td>54.54467</td>
<td>5.388156e+07</td>
<td>44481.691242</td>
<td>1.598722e+08</td>
<td>76614.777246</td>
<td>7caac8a1-a10b-4878-a2ab-4fdb80e987a4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>E06000003</td>
<td>Redcar and Cleveland</td>
<td></td>
<td>464361</td>
<td>519597</td>
<td>-1.00608</td>
<td>54.56752</td>
<td>2.450695e+08</td>
<td>96703.989701</td>
<td>7.274510e+08</td>
<td>166599.724875</td>
<td>96cc264b-6155-48cb-8fc0-7e41684d2682</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-27" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Coordinates Merging Function</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_coordinates(df, coordinates, merge_col, prefix):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        coordinates[[<span class="st">'lad19nm'</span>, <span class="st">'lat'</span>, <span class="st">'long'</span>]],</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        left_on<span class="op">=</span>merge_col,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        right_on<span class="op">=</span><span class="st">'lad19nm'</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>{</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'lat'</span>: <span class="ss">f'lat_</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'long'</span>: <span class="ss">f'long_</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.drop(columns<span class="op">=</span>[<span class="st">'lad19nm'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-28" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> merge_coordinates(commute, LA_coordinates, <span class="st">'area_name_origin'</span>, <span class="st">'origin'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> merge_coordinates(commute, LA_coordinates, <span class="st">'area_name_dest'</span>, <span class="st">'dest'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-centrality" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="sec-centrality"><span class="header-section-number">2.2.2</span> Centrality</h3>
<p>Centrality measures how connected a node is in a network. It may add insight into major hubs, act as a proxy for urban/rural splits, and soak up concerns around spatial autocorrelation.</p>
<p>This is literature-driven, as Tranos et al.&nbsp;(2015) demonstated that centrality play a key role in understanding international migration flows, and it is reasonable to believe this may also apply at a smaller scale.</p>
<p>I use an undirected graph (visualised in <a href="#fig-centr" class="quarto-xref">Figure&nbsp;5</a>) and calulate a normalised centrality metric based on node connections (i.e.&nbsp;the number of connections divided by the maximum number of connections), as this can be done quickly with the data provided.</p>
<div id="cell-34" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> commute_centr.iterrows():</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    G.add_edge(row[<span class="st">'area_name_origin'</span>], row[<span class="st">'area_name_dest'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-35" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>degree_centrality <span class="op">=</span> nx.degree_centrality(G)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>centrality <span class="op">=</span> pd.DataFrame({</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'area_name'</span>: <span class="bu">list</span>(degree_centrality.keys()),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'centrality'</span>: <span class="bu">list</span>(degree_centrality.values())</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-36" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Centrality Merging Function</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_centrality(df, centrality, merge_col, prefix):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        centrality,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        left_on<span class="op">=</span>merge_col,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        right_on<span class="op">=</span><span class="st">'area_name'</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>{</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'centrality'</span>: <span class="ss">f'centrality_</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.drop(columns<span class="op">=</span>[<span class="st">'area_name'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-37" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> merge_centrality(commute, centrality, <span class="st">'area_name_origin'</span>, <span class="st">'origin'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> merge_centrality(commute, centrality, <span class="st">'area_name_dest'</span>, <span class="st">'dest'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-38" class="cell" data-execution_count="42">
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_code_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">area_code_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">travel_time_dest</th>
<th data-quarto-table-cell-role="th">gcse_rate_dest</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
<th data-quarto-table-cell-role="th">lat_origin</th>
<th data-quarto-table-cell-role="th">long_origin</th>
<th data-quarto-table-cell-role="th">lat_dest</th>
<th data-quarto-table-cell-role="th">long_dest</th>
<th data-quarto-table-cell-role="th">centrality_origin</th>
<th data-quarto-table-cell-role="th">centrality_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2019-01-02</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>Stockton-on-Tees</td>
<td>E06000004</td>
<td>1.5423</td>
<td>5</td>
<td>12951.008041</td>
<td>92401</td>
<td>196860</td>
<td>...</td>
<td>13.2</td>
<td>69.5</td>
<td>7.40</td>
<td>616</td>
<td>54.67614</td>
<td>-1.27018</td>
<td>54.556911</td>
<td>-1.30664</td>
<td>0.025862</td>
<td>0.051724</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-02</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>County Durham</td>
<td>E06000047</td>
<td>1.5683</td>
<td>5</td>
<td>37592.170378</td>
<td>92401</td>
<td>518562</td>
<td>...</td>
<td>14.1</td>
<td>67.6</td>
<td>7.43</td>
<td>1343</td>
<td>54.67614</td>
<td>-1.27018</td>
<td>54.685131</td>
<td>-1.84050</td>
<td>0.025862</td>
<td>0.077586</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2019-01-02</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Redcar and Cleveland</td>
<td>E06000003</td>
<td>0.9239</td>
<td>8</td>
<td>13069.176565</td>
<td>142134</td>
<td>136699</td>
<td>...</td>
<td>13.3</td>
<td>69.6</td>
<td>7.44</td>
<td>365</td>
<td>54.54467</td>
<td>-1.21099</td>
<td>54.567520</td>
<td>-1.00608</td>
<td>0.043103</td>
<td>0.025862</td>
</tr>
</tbody>
</table>

<p>3 rows × 30 columns</p>
</div>
</div>
</div>
</section>
<section id="sec-accomodation-rental-cost" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="sec-accomodation-rental-cost"><span class="header-section-number">2.2.3</span> Accommodation Rental Cost</h3>
<p>Multiple studies (So et al., 2001; Ahrens and Lyons, 2021; Wander and Blumenberg, 2024) have shown that the cost of accommodation is a key factor in commuting decisions, using varying metrics such as house prices, rental fees, etc. I include rental costs as the data is available at the LA level in 2019 from the same data source as other variables (ONS). The metric can be used as a proxy for accommodation costs generally (i.e.&nbsp;house prices, which are likely to be correlated).</p>
<p>Data can be found here: <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/housing/bulletins/privaterentalmarketsummarystatisticsinengland/october2018toseptember2019">ONS Private Rental Market Summary</a>.</p>
<div id="cell-41" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>rent <span class="op">=</span> pd.read_csv(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    os.path.join(base_data_dir, <span class="st">"datadownload - extract.csv"</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>rent.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LA Code1</th>
<th data-quarto-table-cell-role="th">Area Code1</th>
<th data-quarto-table-cell-role="th">Area</th>
<th data-quarto-table-cell-role="th">Room</th>
<th data-quarto-table-cell-role="th">Studio</th>
<th data-quarto-table-cell-role="th">One Bedroom</th>
<th data-quarto-table-cell-role="th">Two Bedrooms</th>
<th data-quarto-table-cell-role="th">Three Bedrooms</th>
<th data-quarto-table-cell-role="th">Four or more Bedrooms</th>
<th data-quarto-table-cell-role="th">All categories</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>E92000001</td>
<td>ENGLAND</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>E12000001</td>
<td>NORTH EAST</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1355.0</td>
<td>E06000047</td>
<td>County Durham</td>
<td>368</td>
<td>..</td>
<td>350</td>
<td>425</td>
<td>495</td>
<td>695</td>
<td>450</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Columns are converted to the correct format. I select the <code>"All categories"</code> column (average rental cost for all properties), as otherwise, I would need to take a view on what kind of property to use, which may introduce bias.</p>
<div id="cell-45" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Rent Merging Function</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_rent(df, rent, merge_col, prefix):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        rent[[<span class="st">'Area'</span>, <span class="st">'All categories'</span>]],</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        left_on<span class="op">=</span>merge_col,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        right_on<span class="op">=</span><span class="st">'Area'</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>{</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'All categories'</span>: <span class="ss">f'avg_monthly_rent_</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.drop(columns<span class="op">=</span>[<span class="st">'Area'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-46" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> merge_rent(commute, rent, <span class="st">'area_name_origin'</span>, <span class="st">'origin'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> merge_rent(commute, rent, <span class="st">'area_name_dest'</span>, <span class="st">'dest'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="sec-data-aggregation" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-data-aggregation"><span class="header-section-number">2.3</span> Data Aggregation</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subsection Summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Absolute differences for each variable are calculated between the two local authorities for each route</li>
<li>The dataset is aggregated to one row per route, per local authority pair, per year</li>
</ul>
</div>
</div>
</div>
<p>As per the research question, I take the average of the data over the year. This is done by grouping by the origin and destination local authorities, and taking the mean of the varying variables such as <code>'journey_score'</code> and <code>'avg_monthly_rent_origin'</code>. For the point in time variables, I take the first value as they are constant over the year.</p>
<div id="cell-52" class="cell" data-execution_count="50">
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">value_added_hourly_origin</th>
<th data-quarto-table-cell-role="th">median_weekly_pay_origin</th>
<th data-quarto-table-cell-role="th">emp_rate_origin</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
<th data-quarto-table-cell-role="th">lat_origin</th>
<th data-quarto-table-cell-role="th">long_origin</th>
<th data-quarto-table-cell-role="th">lat_dest</th>
<th data-quarto-table-cell-role="th">long_dest</th>
<th data-quarto-table-cell-role="th">avg_monthly_rent_origin</th>
<th data-quarto-table-cell-role="th">avg_monthly_rent_dest</th>
<th data-quarto-table-cell-role="th">centrality_origin</th>
<th data-quarto-table-cell-role="th">centrality_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Barking and Dagenham</td>
<td>Brent</td>
<td>-0.707100</td>
<td>1.000000</td>
<td>27881.522854</td>
<td>218828</td>
<td>347424</td>
<td>36.89</td>
<td>523.5</td>
<td>67.3</td>
<td>...</td>
<td>7.25</td>
<td>2404</td>
<td>51.545551</td>
<td>0.129479</td>
<td>51.564411</td>
<td>-0.275680</td>
<td>1200.0</td>
<td>1452.0</td>
<td>0.189655</td>
<td>0.258621</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Barking and Dagenham</td>
<td>Camden</td>
<td>0.040885</td>
<td>2.295455</td>
<td>20345.000863</td>
<td>218828</td>
<td>217136</td>
<td>36.89</td>
<td>523.5</td>
<td>67.3</td>
<td>...</td>
<td>6.78</td>
<td>509</td>
<td>51.545551</td>
<td>0.129479</td>
<td>51.543060</td>
<td>-0.162890</td>
<td>1200.0</td>
<td>2058.0</td>
<td>0.189655</td>
<td>0.336207</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Barking and Dagenham</td>
<td>Enfield</td>
<td>0.020474</td>
<td>2.558559</td>
<td>19482.245346</td>
<td>218828</td>
<td>335151</td>
<td>36.89</td>
<td>523.5</td>
<td>67.3</td>
<td>...</td>
<td>6.86</td>
<td>797</td>
<td>51.545551</td>
<td>0.129479</td>
<td>51.648880</td>
<td>-0.081470</td>
<td>1200.0</td>
<td>1250.0</td>
<td>0.189655</td>
<td>0.189655</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Barking and Dagenham</td>
<td>Greenwich</td>
<td>0.076071</td>
<td>2.899083</td>
<td>9642.046411</td>
<td>218828</td>
<td>288205</td>
<td>36.89</td>
<td>523.5</td>
<td>67.3</td>
<td>...</td>
<td>7.22</td>
<td>1042</td>
<td>51.545551</td>
<td>0.129479</td>
<td>51.463928</td>
<td>0.050107</td>
<td>1200.0</td>
<td>1350.0</td>
<td>0.189655</td>
<td>0.241379</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Barking and Dagenham</td>
<td>Hackney</td>
<td>0.017374</td>
<td>3.161074</td>
<td>13748.465842</td>
<td>218828</td>
<td>265825</td>
<td>36.89</td>
<td>523.5</td>
<td>67.3</td>
<td>...</td>
<td>6.94</td>
<td>969</td>
<td>51.545551</td>
<td>0.129479</td>
<td>51.554920</td>
<td>-0.060450</td>
<td>1200.0</td>
<td>1699.0</td>
<td>0.189655</td>
<td>0.224138</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1257</td>
<td>Wolverhampton</td>
<td>Telford and Wrekin</td>
<td>0.120656</td>
<td>2.984615</td>
<td>29347.918605</td>
<td>263519</td>
<td>182081</td>
<td>27.86</td>
<td>481.3</td>
<td>72.5</td>
<td>...</td>
<td>7.39</td>
<td>836</td>
<td>52.597881</td>
<td>-2.127460</td>
<td>52.714169</td>
<td>-2.489410</td>
<td>555.0</td>
<td>575.0</td>
<td>0.068966</td>
<td>0.043103</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1258</td>
<td>Wolverhampton</td>
<td>Walsall</td>
<td>0.999048</td>
<td>8.206349</td>
<td>10596.257678</td>
<td>263519</td>
<td>284600</td>
<td>27.86</td>
<td>481.3</td>
<td>72.5</td>
<td>...</td>
<td>7.35</td>
<td>145</td>
<td>52.597881</td>
<td>-2.127460</td>
<td>52.605030</td>
<td>-1.970440</td>
<td>555.0</td>
<td>550.0</td>
<td>0.068966</td>
<td>0.051724</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1259</td>
<td>York</td>
<td>East Riding of Yorkshire</td>
<td>0.321147</td>
<td>4.313492</td>
<td>38473.087474</td>
<td>203877</td>
<td>338944</td>
<td>34.64</td>
<td>478.2</td>
<td>78.2</td>
<td>...</td>
<td>7.74</td>
<td>1447</td>
<td>53.965820</td>
<td>-1.073750</td>
<td>53.881119</td>
<td>-0.661950</td>
<td>775.0</td>
<td>495.0</td>
<td>0.025862</td>
<td>0.051724</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1260</td>
<td>York</td>
<td>Leeds</td>
<td>0.247854</td>
<td>4.144628</td>
<td>32762.280089</td>
<td>203877</td>
<td>804640</td>
<td>34.64</td>
<td>478.2</td>
<td>78.2</td>
<td>...</td>
<td>7.28</td>
<td>2950</td>
<td>53.965820</td>
<td>-1.073750</td>
<td>53.822731</td>
<td>-1.507360</td>
<td>775.0</td>
<td>675.0</td>
<td>0.025862</td>
<td>0.103448</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1261</td>
<td>York</td>
<td>Wakefield</td>
<td>0.000000</td>
<td>1.666667</td>
<td>40490.805449</td>
<td>203877</td>
<td>348201</td>
<td>34.64</td>
<td>478.2</td>
<td>78.2</td>
<td>...</td>
<td>7.28</td>
<td>1227</td>
<td>53.965820</td>
<td>-1.073750</td>
<td>53.659222</td>
<td>-1.420920</td>
<td>775.0</td>
<td>525.0</td>
<td>0.025862</td>
<td>0.086207</td>
</tr>
</tbody>
</table>

<p>1262 rows × 29 columns</p>
</div>
</div>
</div>
<section id="sec-paired-data" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="sec-paired-data"><span class="header-section-number">2.3.1</span> Addressing Paired Data</h3>
<p>The dataset is structured as paired routes, i.e.&nbsp;for most A to B routes, there is also a B to A route on the same day. This makes sense as a) employees may commute in both directions and b) commuting data may include the return journey.</p>
<p>However, it presents a problem for this specific dataset, as the <code>'journey_score'</code> is not symmetric/directional but is instead a raw measure of popularity, whereas almost all the other variables are in the context of origin/dest directions. The only exception is <code>'distance'</code>, which is the same in both directions. &nbsp; Without addressing this dataset structure, the model will be confused by positive and similar <code>'journey_scores'</code> where all other variables are equal and opposite.</p>
<p>For example, for the route between “Bristol” and “Bath”:</p>
<div id="cell-55" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Filter for Bristol to Bath Commute</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>bristol_to_bath <span class="op">=</span> commute[</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    ((commute[<span class="st">'area_name_origin'</span>] <span class="op">==</span> <span class="st">'Bristol, City of'</span>) <span class="op">&amp;</span> (commute[<span class="st">'area_name_dest'</span>] <span class="op">==</span> <span class="st">'Bath and North East Somerset'</span>)) <span class="op">|</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    ((commute[<span class="st">'area_name_origin'</span>] <span class="op">==</span> <span class="st">'Bath and North East Somerset'</span>) <span class="op">&amp;</span> (commute[<span class="st">'area_name_dest'</span>] <span class="op">==</span> <span class="st">'Bristol, City of'</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>bristol_to_bath</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">value_added_hourly_origin</th>
<th data-quarto-table-cell-role="th">median_weekly_pay_origin</th>
<th data-quarto-table-cell-role="th">emp_rate_origin</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
<th data-quarto-table-cell-role="th">lat_origin</th>
<th data-quarto-table-cell-role="th">long_origin</th>
<th data-quarto-table-cell-role="th">lat_dest</th>
<th data-quarto-table-cell-role="th">long_dest</th>
<th data-quarto-table-cell-role="th">avg_monthly_rent_origin</th>
<th data-quarto-table-cell-role="th">avg_monthly_rent_dest</th>
<th data-quarto-table-cell-role="th">centrality_origin</th>
<th data-quarto-table-cell-role="th">centrality_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>Bath and North East Somerset</td>
<td>Bristol, City of</td>
<td>0.811427</td>
<td>6.350598</td>
<td>15196.650331</td>
<td>190176</td>
<td>469920</td>
<td>28.73</td>
<td>459.8</td>
<td>82.0</td>
<td>...</td>
<td>7.15</td>
<td>1621</td>
<td>51.356041</td>
<td>-2.48654</td>
<td>51.471149</td>
<td>-2.57742</td>
<td>990.0</td>
<td>975.0</td>
<td>0.034483</td>
<td>0.051724</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">132</td>
<td>Bristol, City of</td>
<td>Bath and North East Somerset</td>
<td>0.844441</td>
<td>6.519841</td>
<td>15196.650331</td>
<td>469920</td>
<td>190176</td>
<td>31.01</td>
<td>528.3</td>
<td>77.1</td>
<td>...</td>
<td>7.29</td>
<td>764</td>
<td>51.471149</td>
<td>-2.57742</td>
<td>51.356041</td>
<td>-2.48654</td>
<td>975.0</td>
<td>990.0</td>
<td>0.051724</td>
<td>0.034483</td>
</tr>
</tbody>
</table>

<p>2 rows × 29 columns</p>
</div>
</div>
</div>
<p>Here, we can see that the <code>'journey_score'</code> is approximately the same in both directions, but all other variables (excluding <code>'distance'</code>) are flipped.</p>
<p>This would directly influence the model interpretation, since <code>'distance'</code> is the only symmetric variable, it would be the only variable that could feasibly explain variation in the <code>'journey_score'</code> and its importance would be inflated.</p>
</section>
<section id="sec-calculating-differences" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="sec-calculating-differences"><span class="header-section-number">2.3.2</span> Calculating Differences</h3>
<p>Given the research question, I believe the differences between the two regions are more important than the absolute variables in explaining the popularity of the routes. This is because they reflect a gradient/contrast effect between the regions, likely influencing patterns more directly than isolated conditions within either region.</p>
<p>In plain terms, a person within a region with a high average salary is perhaps less likely to commute to another region with a high average wage relative to a person within a region with a low average wage, i.e.&nbsp;the relative difference between the two regions is more important. Again, this is a subjective, researcher-driven decision as opposed to the only way to do it.</p>
<p>To obtain directionless variables, I take the absolute difference between the origin and destination (and then drop all the original columns). This ensures they are the same for both route directions, and therefore, any model is not confused by the direction of the route.</p>
<div id="cell-61" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>columns_to_diff <span class="op">=</span> [</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'population'</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'value_added_hourly'</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'median_weekly_pay'</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'emp_rate'</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'travel_time'</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gcse_rate'</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'life_satisfaction'</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'housing_growth'</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_monthly_rent'</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'centrality'</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columns_to_diff:</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    commute[<span class="ss">f'|_</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_diff_|'</span>] <span class="op">=</span> <span class="bu">abs</span>( <span class="co"># | x | to display the absolute value of the difference</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        commute[<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_origin'</span>] <span class="op">-</span> commute[<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_dest'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For geometric variables, I will the midpoint of the origin and destination local authorities, as this can later be used so consider spatial relationships between routes.</p>
<div id="cell-66" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>commute[<span class="st">'midpoint_long'</span>] <span class="op">=</span> (commute[<span class="st">'long_origin'</span>] <span class="op">+</span> commute[<span class="st">'long_dest'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>commute[<span class="st">'midpoint_lat'</span>] <span class="op">=</span> (commute[<span class="st">'lat_origin'</span>] <span class="op">+</span> commute[<span class="st">'lat_dest'</span>]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>commute[<span class="st">'route_midpoint_(geo)'</span>] <span class="op">=</span> gpd.points_from_xy(commute[<span class="st">'midpoint_long'</span>], commute[<span class="st">'midpoint_lat'</span>])</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>commute <span class="op">=</span> commute.drop(columns<span class="op">=</span>[<span class="st">'long_origin'</span>, <span class="st">'lat_origin'</span>, <span class="st">'long_dest'</span>, <span class="st">'lat_dest'</span>, <span class="st">'midpoint_long'</span>, <span class="st">'midpoint_lat'</span>,])</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>commute.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">|_population_diff_|</th>
<th data-quarto-table-cell-role="th">|_value_added_hourly_diff_|</th>
<th data-quarto-table-cell-role="th">|_median_weekly_pay_diff_|</th>
<th data-quarto-table-cell-role="th">|_emp_rate_diff_|</th>
<th data-quarto-table-cell-role="th">|_travel_time_diff_|</th>
<th data-quarto-table-cell-role="th">|_gcse_rate_diff_|</th>
<th data-quarto-table-cell-role="th">|_life_satisfaction_diff_|</th>
<th data-quarto-table-cell-role="th">|_housing_growth_diff_|</th>
<th data-quarto-table-cell-role="th">|_avg_monthly_rent_diff_|</th>
<th data-quarto-table-cell-role="th">|_centrality_diff_|</th>
<th data-quarto-table-cell-role="th">route_midpoint_(geo)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Barking and Dagenham</td>
<td>Brent</td>
<td>-0.707100</td>
<td>1.000000</td>
<td>27881.522854</td>
<td>128596</td>
<td>0.07</td>
<td>29.6</td>
<td>3.1</td>
<td>0.9</td>
<td>3.5</td>
<td>0.10</td>
<td>1356</td>
<td>252.0</td>
<td>0.068966</td>
<td>POINT (-0.07310 51.55498)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Barking and Dagenham</td>
<td>Camden</td>
<td>0.040885</td>
<td>2.295455</td>
<td>20345.000863</td>
<td>1692</td>
<td>14.43</td>
<td>170.7</td>
<td>2.3</td>
<td>2.7</td>
<td>4.3</td>
<td>0.57</td>
<td>539</td>
<td>858.0</td>
<td>0.146552</td>
<td>POINT (-0.01671 51.54431)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Barking and Dagenham</td>
<td>Enfield</td>
<td>0.020474</td>
<td>2.558559</td>
<td>19482.245346</td>
<td>116323</td>
<td>5.36</td>
<td>15.6</td>
<td>2.5</td>
<td>0.1</td>
<td>0.7</td>
<td>0.49</td>
<td>251</td>
<td>50.0</td>
<td>0.000000</td>
<td>POINT (0.02400 51.59722)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sec-removing-pairs" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="sec-removing-pairs"><span class="header-section-number">2.3.3</span> Removing Pairs</h3>
<p>I remove the paired routes, replacing them with a single route with the average of the two routes. Given the similarity of the “journey scores” between routes, this is a reasonable assumption to make, with the caveat that where there are large differences, there is a loss of information and potential bias. However, exploration of the data shows that this is rarely an issue, as the data seems to include journeys to and from the same local authority.</p>
<p>The dataset following this process looks like:</p>
<div id="cell-70" class="cell" data-execution_count="59">
<div class="cell-output cell-output-display" data-execution_count="59">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pairs</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">|_population_diff_|</th>
<th data-quarto-table-cell-role="th">|_value_added_hourly_diff_|</th>
<th data-quarto-table-cell-role="th">|_median_weekly_pay_diff_|</th>
<th data-quarto-table-cell-role="th">|_emp_rate_diff_|</th>
<th data-quarto-table-cell-role="th">|_travel_time_diff_|</th>
<th data-quarto-table-cell-role="th">|_gcse_rate_diff_|</th>
<th data-quarto-table-cell-role="th">|_life_satisfaction_diff_|</th>
<th data-quarto-table-cell-role="th">|_housing_growth_diff_|</th>
<th data-quarto-table-cell-role="th">|_avg_monthly_rent_diff_|</th>
<th data-quarto-table-cell-role="th">|_centrality_diff_|</th>
<th data-quarto-table-cell-role="th">route_midpoint_(geo)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Barking and Dagenham - Barnet</td>
<td>-0.010609</td>
<td>1.363636</td>
<td>25056.274464</td>
<td>171762</td>
<td>0.09</td>
<td>51.4</td>
<td>8.3</td>
<td>0.9</td>
<td>13.4</td>
<td>0.05</td>
<td>1202</td>
<td>150.0</td>
<td>0.017241</td>
<td>POINT (-0.04437 51.57832)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Barking and Dagenham - Brent</td>
<td>-0.397323</td>
<td>1.291667</td>
<td>27881.522854</td>
<td>128596</td>
<td>0.07</td>
<td>29.6</td>
<td>3.1</td>
<td>0.9</td>
<td>3.5</td>
<td>0.10</td>
<td>1356</td>
<td>252.0</td>
<td>0.068966</td>
<td>POINT (-0.07310 51.55498)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Barking and Dagenham - Camden</td>
<td>0.112844</td>
<td>2.959443</td>
<td>20345.000863</td>
<td>1692</td>
<td>14.43</td>
<td>170.7</td>
<td>2.3</td>
<td>2.7</td>
<td>4.3</td>
<td>0.57</td>
<td>539</td>
<td>858.0</td>
<td>0.146552</td>
<td>POINT (-0.01671 51.54431)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Barking and Dagenham - Enfield</td>
<td>-0.004368</td>
<td>2.500977</td>
<td>19482.245346</td>
<td>116323</td>
<td>5.36</td>
<td>15.6</td>
<td>2.5</td>
<td>0.1</td>
<td>0.7</td>
<td>0.49</td>
<td>251</td>
<td>50.0</td>
<td>0.000000</td>
<td>POINT (0.02400 51.59722)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Barking and Dagenham - Greenwich</td>
<td>0.114385</td>
<td>2.973163</td>
<td>9642.046411</td>
<td>69377</td>
<td>1.56</td>
<td>95.4</td>
<td>8.3</td>
<td>0.0</td>
<td>0.8</td>
<td>0.13</td>
<td>6</td>
<td>150.0</td>
<td>0.051724</td>
<td>POINT (0.08979 51.50474)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">672</td>
<td>West Berkshire - Wokingham</td>
<td>0.163863</td>
<td>2.844894</td>
<td>29259.923429</td>
<td>10906</td>
<td>4.18</td>
<td>64.6</td>
<td>5.8</td>
<td>1.6</td>
<td>5.6</td>
<td>0.01</td>
<td>512</td>
<td>175.0</td>
<td>0.008621</td>
<td>POINT (-1.08649 51.43427)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">673</td>
<td>Westminster - Wiltshire</td>
<td>0.075996</td>
<td>1.931034</td>
<td>126401.984988</td>
<td>294570</td>
<td>21.88</td>
<td>290.4</td>
<td>10.8</td>
<td>9.5</td>
<td>4.9</td>
<td>0.29</td>
<td>2266</td>
<td>1633.0</td>
<td>0.344828</td>
<td>POINT (-1.03978 51.42052)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">674</td>
<td>Westminster - Windsor and Maidenhead</td>
<td>0.026557</td>
<td>2.449654</td>
<td>37615.785116</td>
<td>54522</td>
<td>0.44</td>
<td>164.8</td>
<td>11.9</td>
<td>4.6</td>
<td>0.8</td>
<td>0.29</td>
<td>270</td>
<td>1183.0</td>
<td>0.318966</td>
<td>POINT (-0.41418 51.49627)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">675</td>
<td>Westminster - Wokingham</td>
<td>-0.168467</td>
<td>1.416667</td>
<td>51144.513300</td>
<td>36626</td>
<td>4.76</td>
<td>113.0</td>
<td>10.0</td>
<td>6.8</td>
<td>3.1</td>
<td>0.12</td>
<td>549</td>
<td>1283.0</td>
<td>0.344828</td>
<td>POINT (-0.52615 51.46758)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">676</td>
<td>Windsor and Maidenhead - Wokingham</td>
<td>0.161748</td>
<td>2.881737</td>
<td>14209.316238</td>
<td>17896</td>
<td>5.20</td>
<td>51.8</td>
<td>1.9</td>
<td>2.2</td>
<td>2.3</td>
<td>0.17</td>
<td>819</td>
<td>100.0</td>
<td>0.025862</td>
<td>POINT (-0.78738 51.45165)</td>
</tr>
</tbody>
</table>

<p>677 rows × 15 columns</p>
</div>
</div>
</div>
<p>i.e.&nbsp;677 unqiue directionless routes.</p>
</section>
</section>
<section id="sec-feature-transformations" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sec-feature-transformations"><span class="header-section-number">2.4</span> Feature Transformations</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Subsection Summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Skenewness is identified in the data</li>
<li>Discussion around addressing this depend on the model used</li>
</ul>
</div>
</div>
</div>
<p>Preliminary exploratory data analysis highlighted the following key points:</p>
<ul>
<li>The <code>'journey_score'</code> variable is not normally distributed</li>
<li>No explanatory variables are normally distributed
<ul>
<li>Generally are clustered around 0</li>
</ul></li>
</ul>
<p>Both these poitns are visualised in <a href="#fig-histogram" class="quarto-xref">Figure&nbsp;6</a>, full details can be found in <a href="#sec-eda" class="quarto-xref">Appendix B - EDA&nbsp;6.2</a>.</p>
<p>I will proceed with analytical decisions with this in mind going forward on a model by model basis, considering the use of transformations where appropriate.</p>
</section>
</section>
<section id="sec-linear-regression" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Linear Regression (OLS and SEM)</h1>
<p>My primary method to address the research question will be linear regressions, as they generally have the most inferential power and are simple to interpret/understand. OLS coefficients can provide data on both the strength of a relationship (what our research question is asking), the direction of the relationship (positive or negative), and also the effect size (i.e.&nbsp;how much the dependent variable changes for a unit change in the independent variable) holding everything else constant.</p>
<p>Other models generally can provide information only on relative importance. However, this is a developing area with analytical innovations such as Shapley values, which can provide a consistent measure of relative importance across models (Buckmann &amp; Joseph, 2022). This is important to note, but not considered here for simplicity.</p>
<p>The linear regression/OLS method relies on a number of important assumptions, which, if not met, can lead to bias and incorrect inference.</p>
<p>As is common practice, I will use a 95% confidence level to determine significance, but other levels may also be discussed.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Further Information on Linear Regression / OLS
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The form of the model is:</p>
<p><span class="math display">\[
y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... + \beta_n x_n + \epsilon\]</span></p>
<p>Where:</p>
<ul>
<li><p><span class="math inline">\(y\)</span> is the dependent variable (i.e.&nbsp;the variable we are trying to predict)</p></li>
<li><p><span class="math inline">\(x_1, x_2, ..., x_n\)</span> are the independent variables (i.e.&nbsp;the variables we are using to predict <span class="math inline">\(y\)</span>)</p></li>
<li><p><span class="math inline">\(\beta_0\)</span> is the intercept (i.e.&nbsp;the value of <span class="math inline">\(y\)</span> when all <span class="math inline">\(x\)</span> are 0)</p></li>
<li><p><span class="math inline">\(\beta_1, \beta_2, ..., \beta_n\)</span> are the coefficients (i.e.&nbsp;the effect of each <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span>)</p></li>
<li><p><span class="math inline">\(\epsilon\)</span> is the error term (i.e.&nbsp;the difference between the predicted and actual value of <span class="math inline">\(y\)</span>)</p></li>
</ul>
<p>Assumptions</p>
<ul>
<li><p>Linearity: The regression model is linear in parameters (coefficients)</p></li>
<li><p>Zero mean of errors: The expected value of the error term is zero</p></li>
<li><p>Homoscedasticity: The error term has constant variance across all levels of the independent variables</p></li>
<li><p>Independence of errors: The error terms are uncorrelated with each other i.e.&nbsp;no autocorrelation</p></li>
<li><p>No perfect multicollinearity: Independent variables are not perfectly linearly related i.e.&nbsp;no redundant predictors</p></li>
</ul>
<p>Impact on inference if failed:</p>
<ul>
<li><p>Linearity: The the estimated effects will be biased and therefore unreliable</p></li>
<li><p>Zero mean of errors: The constant term absorbs systematic error, leading to biasing coefficient estimates</p></li>
<li><p>Homoscedasticity: Standard errors will be incorrect, making inference of p-values and confidence intervals potentially incorrect when determining statistical significance</p></li>
<li><p>Independence of errors: Standard errors are underestimated, which inflates statistical significance metrics again leading to incorrect conclusions</p></li>
<li><p>No endogeneity: Coefficient estimates are biased and therefore unreliable when determining the effect of independent variables on the dependent variable</p></li>
</ul>
</div>
</div>
</div>
<p>I create a new data frame, so any transformations specific to OLS are not carried forward. This will be the working standard going forward for each model:</p>
<div id="cell-80" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>commuteOLS <span class="op">=</span> commute.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variables are then standardised to ensure they are all on the same scale. This is important for OLS, as the coefficients are directly comparable.</p>
<div id="cell-83" class="cell" data-execution_count="63">
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pairs</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">|_population_diff_|</th>
<th data-quarto-table-cell-role="th">|_value_added_hourly_diff_|</th>
<th data-quarto-table-cell-role="th">|_median_weekly_pay_diff_|</th>
<th data-quarto-table-cell-role="th">|_emp_rate_diff_|</th>
<th data-quarto-table-cell-role="th">|_travel_time_diff_|</th>
<th data-quarto-table-cell-role="th">|_gcse_rate_diff_|</th>
<th data-quarto-table-cell-role="th">|_life_satisfaction_diff_|</th>
<th data-quarto-table-cell-role="th">|_housing_growth_diff_|</th>
<th data-quarto-table-cell-role="th">|_avg_monthly_rent_diff_|</th>
<th data-quarto-table-cell-role="th">|_centrality_diff_|</th>
<th data-quarto-table-cell-role="th">route_midpoint_(geo)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Barking and Dagenham - Barnet</td>
<td>-0.010609</td>
<td>1.363636</td>
<td>0.084152</td>
<td>0.405396</td>
<td>-1.148665</td>
<td>-0.281985</td>
<td>1.081910</td>
<td>-0.791513</td>
<td>1.930812</td>
<td>-0.951542</td>
<td>0.337307</td>
<td>-0.490285</td>
<td>-0.749848</td>
<td>POINT (-0.04437 51.57832)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Barking and Dagenham - Brent</td>
<td>-0.397323</td>
<td>1.291667</td>
<td>0.206818</td>
<td>0.102728</td>
<td>-1.151899</td>
<td>-0.632628</td>
<td>-0.419492</td>
<td>-0.791513</td>
<td>-0.525323</td>
<td>-0.633139</td>
<td>0.522719</td>
<td>-0.205973</td>
<td>-0.053169</td>
<td>POINT (-0.07310 51.55498)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Barking and Dagenham - Camden</td>
<td>0.112844</td>
<td>2.959443</td>
<td>-0.120401</td>
<td>-0.787089</td>
<td>1.170277</td>
<td>1.636900</td>
<td>-0.650477</td>
<td>0.243732</td>
<td>-0.326847</td>
<td>2.359855</td>
<td>-0.460928</td>
<td>1.483174</td>
<td>0.991851</td>
<td>POINT (-0.01671 51.54431)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="sec-simple-linear-regression" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-simple-linear-regression"><span class="header-section-number">3.1</span> Simple Linear Regression</h2>
<p>The most straightforward approach is to use variables as they are and run a simple linear regression.</p>
<p>Geometry is not included as point coordinates are non-numeric and, therefore, cannot be directly used in OLS.</p>
<div id="cell-87" class="cell">
<details class="code-fold">
<summary>OLS Regression Script</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> commuteOLS[<span class="st">'journey_score'</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> commuteOLS[[<span class="st">'distance'</span>, <span class="st">'|_population_diff_|'</span>, <span class="st">'|_value_added_hourly_diff_|'</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">'|_median_weekly_pay_diff_|'</span>, <span class="st">'|_emp_rate_diff_|'</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">'|_travel_time_diff_|'</span>, <span class="st">'|_gcse_rate_diff_|'</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">'|_life_satisfaction_diff_|'</span>, <span class="st">'|_housing_growth_diff_|'</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">'|_avg_monthly_rent_diff_|'</span>, <span class="st">'|_centrality_diff_|'</span>]]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>lr_model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lr_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:          journey_score   R-squared:                       0.201
Model:                            OLS   Adj. R-squared:                  0.188
Method:                 Least Squares   F-statistic:                     15.21
Date:                Mon, 05 May 2025   Prob (F-statistic):           1.33e-26
Time:                        14:31:04   Log-Likelihood:                -284.09
No. Observations:                 677   AIC:                             592.2
Df Residuals:                     665   BIC:                             646.4
Df Model:                          11                                         
Covariance Type:            nonrobust                                         
===============================================================================================
                                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-----------------------------------------------------------------------------------------------
const                           0.3031      0.014     21.231      0.000       0.275       0.331
distance                       -0.1696      0.017    -10.152      0.000      -0.202      -0.137
|_population_diff_|             0.0573      0.018      3.239      0.001       0.023       0.092
|_value_added_hourly_diff_|     0.0175      0.016      1.093      0.275      -0.014       0.049
|_median_weekly_pay_diff_|     -0.0238      0.022     -1.080      0.281      -0.067       0.019
|_emp_rate_diff_|               0.0073      0.015      0.473      0.636      -0.023       0.038
|_travel_time_diff_|           -0.0482      0.018     -2.715      0.007      -0.083      -0.013
|_gcse_rate_diff_|             -0.0108      0.015     -0.745      0.457      -0.039       0.018
|_life_satisfaction_diff_|     -0.0058      0.015     -0.389      0.697      -0.035       0.023
|_housing_growth_diff_|         0.0435      0.017      2.505      0.012       0.009       0.078
|_avg_monthly_rent_diff_|       0.0622      0.030      2.091      0.037       0.004       0.121
|_centrality_diff_|            -0.0408      0.022     -1.823      0.069      -0.085       0.003
==============================================================================
Omnibus:                       69.179   Durbin-Watson:                   1.932
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               88.132
Skew:                           0.864   Prob(JB):                     7.29e-20
Kurtosis:                       3.376   Cond. No.                         4.60
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<section id="sec-interpretation-ols-1" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="sec-interpretation-ols-1"><span class="header-section-number">3.1.1</span> Interpretation of the OLS results</h3>
<p>General OLS considerations:</p>
<ul>
<li>R-squared = 0.201, indicates that c.20.1% of the variation in <code>'journey_score'</code> is explained by the linear combination of predictors
<ul>
<li>This isn’t particularly important for inference (relative to prediction) as long as the coefficients are statistically significant, but still a helpful metric</li>
</ul></li>
<li>F-statistic = 15.21 (p = c.0) tests the null hypothesis that all regression coefficients are jointly zero
<ul>
<li>Given the p-value is effectively zero, we reject the null hypothesis at all conventional confidence levels, i.e.&nbsp;the model is statistically significant for explaining some aspect of the variation</li>
</ul></li>
</ul>
<p>Key Variable:</p>
<ul>
<li><code>'distance'</code>, is the most influential with the largest absolute coefficient (0.1696)
<ul>
<li>This implies for every unit standard deviation (std) increase in <code>'distance'</code>, the <code>'journey_score'</code> decreases by 0.1696 stds
<ul>
<li>Holding other variables constant</li>
<li>With a 95% confidence interval of [-0.202, -0.137]</li>
</ul></li>
</ul></li>
<li>It is statistically significant (p &lt; 0.001), and therefore, we can be confident that this is a real effect, i.e.&nbsp;not due to random chance</li>
<li>The narrow confidence interval and large t-statistic imply a precisely estimated and statistically reliable effect</li>
</ul>
<p>Other variables:</p>
<ul>
<li>From the OLS summary, the significant variables ranked (by absolute size of coefficient) are as follows:</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 1%">
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 5%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>#</th>
<th>Variable &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</th>
<th>Coefficient (β)</th>
<th>95% CI &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</th>
<th>p-value</th>
<th>Statistical Inference &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>distance</code></td>
<td>-0.1696 &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td>[-0.202, -0.137] &nbsp; &nbsp; &nbsp;</td>
<td>0.000 &nbsp;</td>
<td>Strong negative effect, highly significant and precisely estimated &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>avg_monthly_rent_diff</code></td>
<td>+0.0622 &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td>[0.004, 0.121] &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td>0.037 &nbsp;</td>
<td>Positive effect, significant (at 5%, but not 1 or 0.1%) and less precise &nbsp; &nbsp; &nbsp; &nbsp;</td>
</tr>
<tr class="odd">
<td>3</td>
<td><code>population_diff</code></td>
<td>+0.0573 &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td>[0.023, 0.092] &nbsp; &nbsp; &nbsp;</td>
<td>0.001 &nbsp;</td>
<td>Positive effect, significant and generally precise &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</td>
</tr>
<tr class="even">
<td>4</td>
<td><code>travel_time_diff</code></td>
<td>-0.0482 &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td>[-0.083, -0.013] &nbsp; &nbsp; &nbsp;</td>
<td>0.007 &nbsp;</td>
<td>Negative effect, significant and less precise &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</td>
</tr>
<tr class="odd">
<td>5</td>
<td><code>housing_growth_diff</code></td>
<td>+0.0435 &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td>[0.009, 0.078] &nbsp; &nbsp; &nbsp;</td>
<td>0.012 &nbsp;</td>
<td>Positive effect, significant (but not at 1 or 0.1%) and generally precise &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</td>
</tr>
<tr class="even">
<td>-</td>
<td>All others &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td>- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td>CI include 0 &nbsp; &nbsp; &nbsp; &nbsp;</td>
<td>&gt;0.05 &nbsp;</td>
<td>No statistical significant 95% confidence &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</td>
</tr>
</tbody>
</table>
<p>Another metric that can be used is permutation importance, which is a measure of how much the model performance decreases when a variable is shuffled randomly and dropped. Therefore, it measures a distinct concept for which provides less inferential power than coefficients. However, it is helpful as a) it can be directly compared to other models and b) it is more robust to multicollinearity:</p>
<div id="cell-90" class="cell">
<details class="code-fold">
<summary>Feature Importance Script</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> lr_model.predict(X)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>baseline_r2 <span class="op">=</span> r2_score(y, y_pred)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>feature_importances <span class="op">=</span> {}</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> X.columns[<span class="dv">1</span>:]:</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    np.random.seed(<span class="dv">0</span>) <span class="co"># for reproducibility</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    X_permuted <span class="op">=</span> X.copy()</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    X_permuted[col] <span class="op">=</span> np.random.permutation(X_permuted[col])</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    y_permuted_pred <span class="op">=</span> lr_model.predict(X_permuted)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    permuted_r2 <span class="op">=</span> r2_score(y, y_permuted_pred)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    feature_importances[col] <span class="op">=</span> baseline_r2 <span class="op">-</span> permuted_r2</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>perm_importance <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(feature_importances.items()), columns<span class="op">=</span>[</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'Variable'</span>, <span class="st">'Permutation Importance'</span>])</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>perm_importance <span class="op">=</span> perm_importance.sort_values(</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">'Permutation Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>perm_importance.head() <span class="co"># only need to show top 5 to compare</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Variable</th>
<th data-quarto-table-cell-role="th">Permutation Importance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>distance</td>
<td>0.308688</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>|_avg_monthly_rent_diff_|</td>
<td>0.051189</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>|_population_diff_|</td>
<td>0.039451</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>|_housing_growth_diff_|</td>
<td>0.024539</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>|_travel_time_diff_|</td>
<td>0.023728</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The results corroborate that of the OLS for the five most influential variables and are generally consistent with the order, with the caveat that with random shuffling, the results are not as precise as OLS and can vary across runs.</p>
</section>
<section id="sec-discussion-ols-1" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="sec-discussion-ols-1"><span class="header-section-number">3.1.2</span> Discussion</h3>
<p>Most of the relationships are intuitively what we would expect. For example, a larger <code>'distance'</code> is associated with a more popular commute route. This, in economic theory, is often attributed to the cost of commuting, as the benefits of commuting (e.g.&nbsp;higher wages) are outweighed by e.g.&nbsp;time, money, and effort (So et al., 2001). The statistic is precisely estimated, which adds confidence to the interpretation, however, preliminary exploratory data analysis in <a href="#sec-eda" class="quarto-xref">Appendix B: Section&nbsp;6.2</a>) shows that the relationship between <code>'journey_score'</code> and <code>'distance'</code> is non-linear (as seen in <a href="#fig-scatterplot" class="quarto-xref">Figure&nbsp;8</a>), which violates the linearity assumption of OLS. This is a key consideration for accurate interpretation of the results, as the confidence interval-based precision assumes this assumption is met.</p>
<p>Similarly, larger <code>'avg_monthly_rent_diff'</code> differences between regions are associated with more popular the routes between them. This result corroborates the findings of Ahrens and Lyons (2021), who identified the same relationship between rent and commuting popularity in their study of Ireland. Since this was a researcher-driven feature addition, it suggests that OVB may have been reduced with its inclusion. This is in contrast to the <code>'centrality'</code> metric added, which was not significant at any confidence level.</p>
<p>Other relationships are less intuitive, and their interpretation is nuanced. For example, &nbsp;<code>'travel_time'</code> represents the average time taken within a local authority to commute to work. The OLS regression results show that a larger difference in <code>'travel_time'</code> between regions is associated with a less popular route. This is counter-intuitive but may reflect that the regions with larger differences in travel time are also those with larger differences in other factors such as <code>'avg_monthly_rent_diff'</code>, which may be driving the popularity of the route. If this is the case, there could be an issue of multicollinearity, which would violate the respective OLS assumption.</p>
<p><code>'housing_growth_diff'</code> reflects a similar relationship <code>'avg_monthly_rent_diff'</code>, and the explanatory factors may be similar. However, housing growth, unlike rent, is a lagging factor i.e.&nbsp;even within the context of annual data, house building can take a significant amount of time and is often driven by demand. This could confuse identifying the cause of the relationship - does housing growth influence commuting popularity, or does commuting popularity influence housing growth?</p>
<p>Final considerations:</p>
<p>Within the discussion, key elements of:</p>
<ul>
<li>Skewed/non-linear data</li>
<li>Multicollinearity</li>
</ul>
<p>which impact the ability to successfully draw an inference to address our research question. The simple OLS regression model is a good starting point, but it is not robust enough to draw a strong conclusion that the five listed variables are the most important factors.</p>
</section>
<section id="sec-multicollinearity-ols-1" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="sec-multicollinearity-ols-1"><span class="header-section-number">3.1.3</span> Multicollinearity</h3>
<p>We can test for collinearity between variables with a correlation matrix, and then use a variance inflation factor (VIF) to assess the impact of collinearity on the model:</p>
<div id="cell-96" class="cell">
<details class="code-fold">
<summary>Correlation Matrix Heatmap Sript</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>commuteOLScm <span class="op">=</span> commuteOLS.drop(columns<span class="op">=</span>[<span class="st">'pairs'</span>, <span class="st">'journey_score'</span>, <span class="st">'journey_count_decile'</span>, <span class="st">'route_midpoint_(geo)'</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>)) </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(commuteOLScm.corr(), annot<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-41-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-97" class="cell">
<details class="code-fold">
<summary>VIF Script</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>vif <span class="op">=</span> pd.DataFrame()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>vif[<span class="st">'Variable'</span>] <span class="op">=</span> X.columns</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>vif[<span class="st">'VIF'</span>] <span class="op">=</span> [variance_inflation_factor(X.values, i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>])]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>vif</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="68">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Variable</th>
<th data-quarto-table-cell-role="th">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>const</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>distance</td>
<td>1.369576</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>|_population_diff_|</td>
<td>1.534792</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>|_value_added_hourly_diff_|</td>
<td>1.261580</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>|_median_weekly_pay_diff_|</td>
<td>2.389630</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>|_emp_rate_diff_|</td>
<td>1.178689</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>|_travel_time_diff_|</td>
<td>1.546928</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>|_gcse_rate_diff_|</td>
<td>1.037265</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>|_life_satisfaction_diff_|</td>
<td>1.085963</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>|_housing_growth_diff_|</td>
<td>1.481976</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>|_avg_monthly_rent_diff_|</td>
<td>4.340401</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>|_centrality_diff_|</td>
<td>2.460915</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The correlation matrix shows limited collinearity between the variables, with the greatest correlation between <code>'avg_monthly_rent_diff'</code> and <code>'median_weekly_pay_diff'</code> (0.73). This is not unexpected, as areas with higher rents will generally require a higher wage rate to afford the rent.</p>
<p>The VIF analysis corroborates this limited collinearity, as all values are below 10, a common concern threshold. All values are above 1, which indicates some level of collinearity present, again with the greatest values being <code>'avg_monthly_rent_diff'</code> (4.3) and <code>'median_weekly_pay_diff'</code> (2.4).</p>
<p>Multicollinearity violates the OLS assumptions and can lead to biased coefficient estimates, so it is important to accommodate for this. The OLS results show that <code>'avg_monthly_rent_diff'</code> is more significant than <code>'median_weekly_pay_diff'</code>, has a larger coefficient, and is more precise, however, the VIF results show it also has greater collinearity with other variables. To optimise for the OLS assumptions, and to avoid the <code>'avg_monthly_rent_diff'</code> soaking up explanatory power from correlated variables, I will drop it from the model in future iterations. This is, again, a researcher-driven, subjective decision.</p>
</section>
</section>
<section id="sec-refined-linear-regression" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-refined-linear-regression"><span class="header-section-number">3.2</span> Refined Linear Regression</h2>
<p>Multiple paths can be taken to address the data’s skewness (shown in <a href="#fig-histogram" class="quarto-xref">Figure&nbsp;6</a>). The most common is to use a log transformation. However, the absolute difference variables include zero values, which do not work with a log transformation. Therefore, a Yeo-Johnson transformation is used, a generalisation of the log transformation that can handle negative values (Yeo and Johnson, 2000).</p>
<div id="cell-102" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>columns_OLSr <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> commuteOLSr.columns <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'journey_score'</span>, <span class="st">'pairs'</span>, <span class="st">'route_midpoint_(geo)'</span>]]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> PowerTransformer(method<span class="op">=</span><span class="st">'yeo-johnson'</span>, standardize<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>commuteOLSr[columns_OLSr] <span class="op">=</span> transformer.fit_transform(commuteOLSr[columns_OLSr])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And running a new OLS regression with the transformed data (with dropped <code>'avg_monthly_rent_diff'</code>):</p>
<div id="cell-104" class="cell">
<details class="code-fold">
<summary>OLS Regression Script</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> commuteOLSr[<span class="st">'journey_score'</span>]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> commuteOLSr[[<span class="st">'distance'</span>, <span class="st">'|_population_diff_|'</span>, <span class="st">'|_value_added_hourly_diff_|'</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">'|_median_weekly_pay_diff_|'</span>, <span class="st">'|_emp_rate_diff_|'</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'|_travel_time_diff_|'</span>, <span class="st">'|_gcse_rate_diff_|'</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'|_life_satisfaction_diff_|'</span>, <span class="st">'|_housing_growth_diff_|'</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'|_centrality_diff_|'</span>]]</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>rlr_model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rlr_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:          journey_score   R-squared:                       0.438
Model:                            OLS   Adj. R-squared:                  0.430
Method:                 Least Squares   F-statistic:                     51.99
Date:                Mon, 05 May 2025   Prob (F-statistic):           7.24e-77
Time:                        14:31:05   Log-Likelihood:                -164.77
No. Observations:                 677   AIC:                             351.5
Df Residuals:                     666   BIC:                             401.2
Df Model:                          10                                         
Covariance Type:            nonrobust                                         
===============================================================================================
                                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-----------------------------------------------------------------------------------------------
const                           0.3031      0.012     25.343      0.000       0.280       0.327
distance                       -0.2759      0.013    -21.054      0.000      -0.302      -0.250
|_population_diff_|             0.0593      0.013      4.449      0.000       0.033       0.086
|_value_added_hourly_diff_|    -0.0050      0.013     -0.387      0.699      -0.031       0.021
|_median_weekly_pay_diff_|     -0.0367      0.014     -2.649      0.008      -0.064      -0.009
|_emp_rate_diff_|               0.0188      0.013      1.494      0.136      -0.006       0.044
|_travel_time_diff_|            0.0180      0.014      1.294      0.196      -0.009       0.045
|_gcse_rate_diff_|             -0.0139      0.012     -1.148      0.252      -0.038       0.010
|_life_satisfaction_diff_|     -0.0079      0.012     -0.635      0.525      -0.032       0.016
|_housing_growth_diff_|         0.0373      0.013      2.806      0.005       0.011       0.063
|_centrality_diff_|            -0.0192      0.014     -1.390      0.165      -0.046       0.008
==============================================================================
Omnibus:                       60.620   Durbin-Watson:                   1.604
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               75.204
Skew:                           0.764   Prob(JB):                     4.67e-17
Kurtosis:                       3.573   Cond. No.                         2.14
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<section id="sec-interpretation-ols-2" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="sec-interpretation-ols-2"><span class="header-section-number">3.2.1</span> Interpretation of the OLS results</h3>
<p>General OLS considerations:</p>
<ul>
<li>R-squared = 0.438, indicates that c.43.8% of the variation in <code>'journey_score'</code> is explained by the linear combination of predictors, an improvement from the previous model (c.20.1%)
<ul>
<li>This is helpful for inference, as it suggests that the model is better at explaining the variation in the data, and therefore the coefficients are more reliable</li>
</ul></li>
<li>F-statistic = 51.99 (p = c.0)
<ul>
<li>Given the p-value is effectively zero, the model is again statistically significant for explaining some aspects of the variation</li>
</ul></li>
</ul>
<p>Key Variable:</p>
<ul>
<li><code>'distance'</code>, is the most influential with the largest coefficient (0.2759), an even larger effect than the previous model (+62.7%)
<ul>
<li>As a result of the transformation, we can no longer make an inference on the marginal impact of a unit change without back-transforming, which is a trade-off</li>
<li>It is statistically significant (p &lt; 0.001), and therefore, again we can be confident that this is a real effect</li>
<li>The narrow confidence interval and large t-statistic implies a precisely estimated and statistically reliable effect</li>
</ul></li>
</ul>
<p>Other variables:</p>
<ul>
<li>With the new specification, <code>'travel_time_diff'</code> is no longer significant at a 95% confidence level</li>
<li>From the OLS summary, the significant variables ranked (by absolute size of coefficient) are as follows:</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 1%">
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 5%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>#</th>
<th>Variable</th>
<th>Coefficient (β)</th>
<th>95% CI</th>
<th>p-value</th>
<th>Relative to Simple OLS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>distance</code></td>
<td>-0.2728</td>
<td>[-0.302, -0.250]</td>
<td>0.000</td>
<td>Stronger negative effect, still highly significant and precisely estimated</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>population_diff</code></td>
<td>+0.0593</td>
<td>[0.033, 0.086]</td>
<td>0.000</td>
<td>Stronger positive effect, significant and generally precise</td>
</tr>
<tr class="odd">
<td>3</td>
<td><code>housing_growth_diff</code></td>
<td>+0.0373</td>
<td>[0.011, 0.063]</td>
<td>0.005</td>
<td>Weaker positive effect, significant (but not at 0.1%) and generally precise</td>
</tr>
<tr class="even">
<td>4</td>
<td><code>median_weekly_pay_diff</code></td>
<td>-0.0367</td>
<td>[-0.064, -0.009]</td>
<td>0.001</td>
<td>Stronger negative effect, now significant</td>
</tr>
<tr class="odd">
<td>-</td>
<td>All others</td>
<td>-</td>
<td>CI include 0</td>
<td>&gt;0.05</td>
<td>No statistical significant 95% confidence</td>
</tr>
</tbody>
</table>
<p>The addition of <code>'median_weekly_pay_diff'</code> suggests that the correlation with <code>'avg_monthly_rent_diff'</code> may have impacted the inference of the previous model, whereas the exclusion of <code>'travel_time_diff'</code> may reflect the change in distribution following the transformation.</p>
<p>Following this, permutation importance:</p>
<div id="cell-107" class="cell">
<details class="code-fold">
<summary>Feature Importance Script</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> rlr_model.predict(X)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>baseline_r2 <span class="op">=</span> r2_score(y, y_pred)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>feature_importances <span class="op">=</span> {}</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> X.columns[<span class="dv">1</span>:]:</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    np.random.seed(<span class="dv">0</span>) <span class="co"># for reproducibility</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    X_permuted <span class="op">=</span> X.copy()</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    X_permuted[col] <span class="op">=</span> np.random.permutation(X_permuted[col])</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    y_permuted_pred <span class="op">=</span> rlr_model.predict(X_permuted)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    permuted_r2 <span class="op">=</span> r2_score(y, y_permuted_pred)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    feature_importances[col] <span class="op">=</span> baseline_r2 <span class="op">-</span> permuted_r2</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>perm_importance <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(feature_importances.items()), columns<span class="op">=</span>[</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'Variable'</span>, <span class="st">'Permutation Importance'</span>])</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>perm_importance <span class="op">=</span> perm_importance.sort_values(</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">'Permutation Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>perm_importance.head(<span class="dv">4</span>) <span class="co"># only need to show top 4 to compare</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Variable</th>
<th data-quarto-table-cell-role="th">Permutation Importance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>distance</td>
<td>0.871311</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>|_population_diff_|</td>
<td>0.038663</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>|_median_weekly_pay_diff_|</td>
<td>0.020285</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>|_housing_growth_diff_|</td>
<td>0.017100</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The results corroborate the Refined OLS with the four most influential variables and are again broadly consistent with the order.</p>
<p>Finally, with the dropped variable and transformed data, we can once again check for multicollinearity:</p>
</section>
<section id="sec-multicollinearity-ols-2" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="sec-multicollinearity-ols-2"><span class="header-section-number">3.2.2</span> Multicollinearity</h3>
<div id="cell-110" class="cell">
<details class="code-fold">
<summary>Correlation Matrix Heatmap Script</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>commuteOLSrcm <span class="op">=</span> commuteOLSr.drop(columns<span class="op">=</span>[<span class="st">'pairs'</span>, <span class="st">'journey_score'</span>, <span class="st">'route_midpoint_(geo)'</span>])</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>)) </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(commuteOLSrcm.corr(), annot<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-47-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-111" class="cell">
<details class="code-fold">
<summary>VIF Script</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>vif <span class="op">=</span> pd.DataFrame()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>vif[<span class="st">'Variable'</span>] <span class="op">=</span> X.columns</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>vif[<span class="st">'VIF'</span>] <span class="op">=</span> [variance_inflation_factor(X.values, i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>])]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>vif</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="74">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Variable</th>
<th data-quarto-table-cell-role="th">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>const</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>distance</td>
<td>1.200264</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>|_population_diff_|</td>
<td>1.243007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>|_value_added_hourly_diff_|</td>
<td>1.188374</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>|_median_weekly_pay_diff_|</td>
<td>1.338856</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>|_emp_rate_diff_|</td>
<td>1.108864</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>|_travel_time_diff_|</td>
<td>1.348697</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>|_gcse_rate_diff_|</td>
<td>1.018920</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>|_life_satisfaction_diff_|</td>
<td>1.072590</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>|_housing_growth_diff_|</td>
<td>1.233093</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>|_centrality_diff_|</td>
<td>1.333514</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Where the concerns around multicollinearity are reduced.</p>
</section>
<section id="sec-discussion-ols-2" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="sec-discussion-ols-2"><span class="header-section-number">3.2.3</span> Discussion</h3>
<p>Generally the results are similar to the previous OLS:</p>
<ul>
<li><p>The top three variables in the new results are all within the top five of the previous OLS</p>
<ul>
<li><p>The addition of <code>'median_weekly_pay_diff'</code> is consistent with previous results due to its correlation with <code>'avg_monthly_rent_diff'</code> which was dropped</p>
<ul>
<li>Interetestingly the signs are different, suggesting as the differnce in median weekly pay increases, the <code>'journey_score'</code> decreases</li>
</ul></li>
</ul></li>
<li><p>The order of influence/importance is the same across both the Simple and Refined OLS for the shared variables</p></li>
<li><p><code>'distance'</code> is materially ahead of the other variables for both, and is the only variable with a coefficient above 0.1 in either model</p></li>
</ul>
<p>With the transformation, <code>'distance'</code> is an even more important predictor of <code>'journey_score'</code>, with a larger coefficient (0.2728, +62.7% relative to simple OLS) and a more precise estimate. As intuitive as this is, it still must be critically challenged. This had been partially addressed by using absolute differences in other variables so they are directionless too.</p>
<p>What remains unconsidered is the potential for spatial autocorrelation, which is a key concern in geospatial data. A disproportionate amount of data points near and within London is observed in the <a href="#fig-geo" class="quarto-xref">Figure&nbsp;2</a> produced in <a href="#sec-eda" class="quarto-xref">Appendix B: Section&nbsp;6.2</a>. Here, distances are shorter, and commuting flows more popular, which could inflate the role of <code>'distance'</code> while underestimating the influence of other socio-economic structure variables. In dense areas like London, shorter distances are still popular, however this may not be because they are short, but due to other factors, e.g.&nbsp;high job density. In addition, socio-economic factors are likely to be more similar nearby, therefore, OLS may not be able to separate the two, instead attributing the high flows to distance alone. Given the potential sampling bias with the overrepresentation of structurally similar regions located near each other, these issues may be magnified as those relationships, in turn, dominate the model. Therefore, addressing some elements of spatial autocorrelation may be necessary.</p>
</section>
</section>
<section id="sec-sem" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-sem"><span class="header-section-number">3.3</span> Spatial Error Model (SEM)</h2>
<p>I use spatial models (e.g., Spatial Error or Lag Models) where residuals may be spatially autocorrelated, as otherwise, the OLS assumption of independence of errors is violated, and inference restricted. Spatial models can account for spatial structure within the residuals and, therefore, if autocorrelation is present, are more reliable than a standard OLS regression. Clustering in commuting flows relating to types of roles has been discussed in the literature (Hincks et al., 2018), and it is reasonable to assume that this may also be present in the data, impacting other variables. Therefore, this will give me more confidence in the inference I can draw to answer the research question.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Further Information on Spatial Error Models (SEM)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The form of the model is (Harris and Jarvis, 2011):</p>
<p><span class="math display">\[
y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \cdots + \lambda \mathbf{W} \xi + \varepsilon
\]</span></p>
<p>Where:</p>
<ul>
<li><p><span class="math inline">\(y\)</span> is the dependent variable</p></li>
<li><p><span class="math inline">\(x_1, x_2,...x_n\)</span> are the independent variables</p></li>
<li><p><span class="math inline">\(\beta_0\)</span> is the intercept</p></li>
<li><p><span class="math inline">\(\beta_1, \beta_2,...\beta_n\)</span> are the coefficients</p></li>
<li><p><span class="math inline">\(\lambda\)</span> is the spatial autocorrelation coefficient</p></li>
<li><p><span class="math inline">\(\mathbf{W}\)</span> is the spatial weights matrix (i.e defines how observations are spatially connected)</p></li>
<li><p><span class="math inline">\(\xi\)</span> is the spatially correlated error term</p></li>
<li><p><span class="math inline">\(\varepsilon\)</span> is the error term for errors not spatially correlated</p></li>
</ul>
<p>Key Assumptions Specific to SEM:</p>
<ul>
<li><p>Spatial autocorrelation in residuals: The error term shows a spatial relationship, captured by <span class="math inline">\(\lambda \mathbf{W} \xi\)</span>. This can be tested for using Moran’s I</p></li>
<li><p>Correct specification of spatial weights: The matrix <span class="math inline">\(\mathbf{W}\)</span> must should accurately reflect the true spatial structure (e.g.&nbsp;distance-based vs kNN)</p></li>
<li><p>No omitted spatial structure: All spatial dependence is captured within the relevant error term</p></li>
</ul>
<p>All other assumptions (e.g.&nbsp;linearity, no perfect multicollinearity, homoscedasticity) are the same as in an OLS regression</p>
</div>
</div>
</div>
<p>The SEM is a generalisation of the OLS model, and therefore, the same assumptions apply. The SEM also includes an additional assumption that the error term is spatially autocorrelated, which is the key difference between the two models.</p>
<p>I ran two spatial weight specification types (distance-based and k-nearest neighbours (kNN)) at various thresholds to mimic sensitivity analysis.</p>
<p>Distance-based weights define neighbours by the physical distance for a given threshold, and kNN defines neighbours by the number of nearest neighbours:</p>
<div id="cell-121" class="cell">
<details class="code-fold">
<summary>Moran’s I Script</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>commuteSEM[<span class="st">'residuals'</span>] <span class="op">=</span> rlr_model.resid</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>d_thresholds <span class="op">=</span> [<span class="dv">10000</span>, <span class="dv">20000</span>, <span class="dv">50000</span>, <span class="dv">100000</span>, <span class="dv">200000</span>]  <span class="co"># in m by default</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> {<span class="st">'Distance-based'</span>: [], <span class="st">'kNN'</span>: []}</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ignore'</span>, message<span class="op">=</span><span class="st">"The weights matrix is not fully connected*"</span>) <span class="co"># get rid of error messags but can discuss</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># distance-based </span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> d <span class="kw">in</span> d_thresholds:</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> DistanceBand.from_dataframe(</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        commuteSEM, threshold<span class="op">=</span>d, silence_warnings<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    w.transform <span class="op">=</span> <span class="st">'r'</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    morani <span class="op">=</span> Moran(commuteSEM[<span class="st">'residuals'</span>], w)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    results[<span class="st">'Distance-based'</span>].append((d <span class="op">/</span> <span class="dv">1000</span>, morani.I, morani.p_sim)) <span class="co"># switching to km</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co"># kNN</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> k:</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> KNN.from_dataframe(commuteSEM, k<span class="op">=</span>k)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    w.transform <span class="op">=</span> <span class="st">'r'</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    morani <span class="op">=</span> Moran(commuteSEM[<span class="st">'residuals'</span>], w)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    results[<span class="st">'kNN'</span>].append((k, morani.I, morani.p_sim))</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>distance <span class="op">=</span> pd.DataFrame(results[<span class="st">'Distance-based'</span>],</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>                       columns<span class="op">=</span>[<span class="st">'Distance (km)'</span>, <span class="st">"Moran's I"</span>, <span class="st">'p-value'</span>])</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>knn <span class="op">=</span> pd.DataFrame(results[<span class="st">'kNN'</span>], columns<span class="op">=</span>[<span class="st">'k'</span>, <span class="st">"Moran's I"</span>, <span class="st">'p-value'</span>])</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Moran's I (distance-based):"</span>)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(distance)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Moran's I (kNN):"</span>)</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(knn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Moran's I (distance-based):
   Distance (km)  Moran's I  p-value
0           10.0   0.122814    0.001
1           20.0   0.118623    0.001
2           50.0   0.105237    0.001
3          100.0   0.072716    0.001
4          200.0   0.035270    0.001

Moran's I (kNN):
    k  Moran's I  p-value
0   1   0.065393    0.088
1   2   0.118213    0.001
2   5   0.135020    0.001
3  10   0.156095    0.001
4  20   0.143852    0.001</code></pre>
</div>
</div>
<p>I selected the kNN specification with 10 neighbours. At 0.156, the Moran’s I value suggests signficant spatial autocorrelation, and is the highest value. The distance-based method adds neighbours in polynomial (or near polynomial) form, leading to greater sensitivity in Moran I’s values. In addition, at most thresholds, not all points are connected which would result in an exclusion of remote data points and therefore bias the results. The kNN method is less sensitive to this, as it will always include the same number of neighbours regardless of distance and generally the kNN method is more interpretable, as it is easier to understand the number of neighbours than the distance between them.</p>
<p>The selection between a Spatial Error Model (SEM) and e.g.&nbsp;a Spatial Lag Model (SLM) is based on the nature of the spatial autocorrelation i.e.&nbsp;SEM is when the spatial autocorrelation is in the residuals, and SLM when in the dependent variable. To test this I use two Lagrange Multiplier (LM) tests respectively:</p>
<div id="cell-123" class="cell">
<details class="code-fold">
<summary>Lagrange Multiplier Tests Script</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> KNN.from_dataframe(commuteSEM, k<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>w.transform <span class="op">=</span> <span class="st">'r'</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> OLS(y, X, w<span class="op">=</span>w, name_y<span class="op">=</span><span class="st">'journey_score'</span>, name_x<span class="op">=</span>X.columns.tolist(), name_w<span class="op">=</span><span class="st">'kNN10'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> ols_model.u </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># LM Error</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>slm_res <span class="op">=</span> lag_spatial(w, residuals)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> residuals</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>e_lag <span class="op">=</span> slm_res</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>sse <span class="op">=</span> np.<span class="bu">sum</span>(e<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>sse_lag <span class="op">=</span> np.<span class="bu">sum</span>(e <span class="op">*</span> e_lag)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>lm_error <span class="op">=</span> (n <span class="op">*</span> (sse_lag<span class="op">**</span><span class="dv">2</span>)) <span class="op">/</span> (sse<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>lm_error_p <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> stats.chi2.cdf(lm_error, df<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># LM lag</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>y_lag <span class="op">=</span> lag_spatial(w, y)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>lm_lag <span class="op">=</span> (n <span class="op">*</span> (np.<span class="bu">sum</span>(y_lag <span class="op">*</span> e)<span class="op">**</span><span class="dv">2</span>)) <span class="op">/</span> (sse <span class="op">*</span> np.<span class="bu">sum</span>(y_lag<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>lm_lag_p <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> stats.chi2.cdf(lm_lag, df<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"LM Error test: </span><span class="sc">{</span>lm_error<span class="sc">:.3f}</span><span class="ss">, p-value: </span><span class="sc">{</span>lm_error_p<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"LM Lag test: </span><span class="sc">{</span>lm_lag<span class="sc">:.3f}</span><span class="ss">, p-value: </span><span class="sc">{</span>lm_lag_p<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>LM Error test: 16.496, p-value: 0.000
LM Lag test: 0.000, p-value: 1.000</code></pre>
</div>
</div>
<p>The tests imply that spatial autocorrelation exists in the residuals but not dependent variables, therefore a SEM is appropriate:</p>
<div id="cell-125" class="cell">
<details class="code-fold">
<summary>SEM Regression Script</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>sem_model <span class="op">=</span> GM_Error_Het(y, X, w<span class="op">=</span>w, name_ds<span class="op">=</span><span class="st">'commuteOLS'</span> , name_w<span class="op">=</span><span class="st">"kNN, k=10"</span>, hard_bound<span class="op">=</span><span class="va">True</span>) <span class="co"># SEM with heteroskedasticity</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sem_model.summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>REGRESSION RESULTS
------------------

SUMMARY OF OUTPUT: GM SPATIALLY WEIGHTED LEAST SQUARES (HET)
------------------------------------------------------------
Data set            :  commuteOLS
Weights matrix      :   kNN, k=10
Dependent Variable  :journey_score                Number of Observations:         677
Mean dependent var  :      0.3031                Number of Variables   :          11
S.D. dependent var  :      0.4122                Degrees of Freedom    :         666
Pseudo R-squared    :      0.4137
N. of iterations    :           1                Step1c computed       :          No

------------------------------------------------------------------------------------
            Variable     Coefficient       Std.Error     z-Statistic     Probability
------------------------------------------------------------------------------------
            CONSTANT         0.31282         0.03323         9.41436         0.00000
            distance        -0.34893         0.01441       -24.20732         0.00000
 |_population_diff_|         0.03319         0.01295         2.56337         0.01037
|_value_added_hourly_diff_|        -0.00456         0.01158        -0.39342         0.69401
|_median_weekly_pay_diff_|        -0.01664         0.01283        -1.29742         0.19449
   |_emp_rate_diff_|         0.01863         0.01113         1.67371         0.09419
|_travel_time_diff_|         0.01954         0.01451         1.34692         0.17801
  |_gcse_rate_diff_|        -0.01647         0.01027        -1.60488         0.10852
|_life_satisfaction_diff_|         0.00155         0.01157         0.13438         0.89310
|_housing_growth_diff_|         0.03430         0.01250         2.74306         0.00609
 |_centrality_diff_|         0.02457         0.01331         1.84668         0.06479
              lambda         0.68295         0.03580        19.07529         0.00000
------------------------------------------------------------------------------------
Warning: Variable(s) ['const'] removed for being constant.
================================ END OF REPORT =====================================</code></pre>
</div>
</div>
<section id="sec-interpretation-sem" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="sec-interpretation-sem"><span class="header-section-number">3.3.1</span> Interpretation of the SEM results</h3>
<p>General SEM considerations:</p>
<ul>
<li>(Pseudo) R-squared = 0.4137
<ul>
<li>This metric is not directly comparable to R-squared, but shows a goodness of fit relative to a model with no variables</li>
<li>At 0.4137, this is a reasonable fit, explaining a fair amount of variation</li>
</ul></li>
</ul>
<p>Key Variable:</p>
<ul>
<li><code>'distance'</code>, is again the most influential with the largest coefficient (0.34893), continuing to dominate in terms of importance even after the consideration of spatial autcorrelation
<ul>
<li>It is statistically significant still (p &lt; 0.001)</li>
</ul></li>
</ul>
<p>Other variables:</p>
<ul>
<li>With the new model specification, <code>'median_weekly_pay_diff'</code> is no longer significant at any confidence level</li>
<li>From the OLS summary, the significant variables ranked (by absolute size of coefficient) are as follows:</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 2%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 60%">
</colgroup>
<thead>
<tr class="header">
<th>#</th>
<th>Variable</th>
<th>Coefficient (β)</th>
<th>p-value</th>
<th>Interpretation vs Refined OLS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>distance</code></td>
<td>-0.3489</td>
<td>0.000</td>
<td>Stronger negative effect</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>population_diff</code></td>
<td>+0.0332</td>
<td>0.000</td>
<td>Weaker positive effect</td>
</tr>
<tr class="odd">
<td>3</td>
<td><code>housing_growth_diff</code></td>
<td>+0.0343</td>
<td>0.006</td>
<td>Weaker positive effect</td>
</tr>
<tr class="even">
<td>-</td>
<td>All others</td>
<td>-</td>
<td>&gt;0.05</td>
<td>Not statistically significant at 95% confidence level</td>
</tr>
</tbody>
</table>
<p>The hypothesis that spatial autocorrelation prevented the OLS from seperating the impact of each vraiable driving the relationship was correct. However the direction for <code>'distance'</code> was wrong, in actuality the other variables were soaking up the explanatory power of <code>'distance'</code>, instead of the other way around. Therefore, the SEM actually suggests that <code>'distance'</code> is even more important than the OLS.</p>
<p>The exclusion of <code>'median_weekly_pay_diff'</code> is interesting, as it was significant in the OLS, but with a counterintuitive negative relationship between difference and flow popularity. This may have been due to spatial autocorrelation, proving further evidence that the SEM adds insight to the inference task.</p>
<p>This is about as deep as I can go with linear regression, and even then, it is not clear whether the SEM/OLS are robust enough, in terms of satisfying key assumptions, to draw an inference with confidence.</p>
<p>This can be seen when assessing the residuals of the SEM:</p>
<div id="cell-fig-residuals" class="cell">
<details class="code-fold">
<summary>Residuals vs Fitted Script</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">'darkgrid'</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> [<span class="st">'#69b3a2'</span>]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>sem_model.predy.flatten(),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>sem_model.u.flatten(), color<span class="op">=</span>palette[<span class="dv">0</span>])</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fitted values'</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Residuals'</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Residuals vs Fitted'</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-residuals" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-residuals-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;1: Scatterplot of residuals vs fitted values"><img src="index_files/figure-html/fig-residuals-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Scatterplot of residuals vs fitted values
</figcaption>
</figure>
</div>
</div>
</div>
<p>Here, we can see that despite best efforts, the variance of residuals changes with fitted values, i.e.&nbsp;heteroscedasticity persists.</p>
</section>
</section>
</section>
<section id="sec-random-forest" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Random Forest</h1>
<p>Given that the assumptions of linear regression may not be fully satisfied in this context, I decide to use a Random Forest model which may be more appropriate.</p>
<p>Random Forests are more robust for inference as they do not rely on satisfying assumptions like linearity, homoscedasticity or independence of residuals. They handle outliers, multicollinearity, and non-linear relationships well, all of which may be relevant in this case.</p>
<p>The trade-off is that they do not provide effect sizes or directions when assessing feature importance directly, however in combination with the results of the regression models, they can provide a more complete picture of the relationships between variables.</p>
<p>This is shown below, using the original dataset (i.e.&nbsp;not standardised or transformed):</p>
<div id="cell-134" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>y_rf <span class="op">=</span> commute[<span class="st">'journey_score'</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>X_rf <span class="op">=</span> commute[[<span class="st">'distance'</span>, <span class="st">'|_population_diff_|'</span>, <span class="st">'|_value_added_hourly_diff_|'</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">'|_median_weekly_pay_diff_|'</span>, <span class="st">'|_emp_rate_diff_|'</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'|_travel_time_diff_|'</span>, <span class="st">'|_gcse_rate_diff_|'</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'|_life_satisfaction_diff_|'</span>, <span class="st">'|_housing_growth_diff_|'</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'|_centrality_diff_|'</span>]]</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>(X_train,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a> X_test,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a> y_train,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a> y_test) <span class="op">=</span> skm.train_test_split(X_rf,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                                y_rf,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                                test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                                random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>commuteRF <span class="op">=</span> RF(max_features<span class="op">=</span><span class="st">'sqrt'</span>,</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>               random_state<span class="op">=</span><span class="dv">0</span>).fit(X_train, y_train)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>y_hat_RF <span class="op">=</span> commuteRF.predict(X_test)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> np.mean((y_test <span class="op">-</span> y_hat_RF)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2_score(y_test, y_hat_RF)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean Squared Error: </span><span class="sc">{</span>mse<span class="sc">.</span><span class="bu">round</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R-squared: </span><span class="sc">{</span>r2<span class="sc">.</span><span class="bu">round</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Squared Error: 0.084
R-squared: 0.485</code></pre>
</div>
</div>
<p>The R-squared of the Random Forest model is 0.485, which is a marginal improvement on the linear regression models, implying that the random forest is able to better capture the relationships between the variables</p>
<p>Rather than coefficients, the Random Forest model has a feature importance metric, which is a measure of how much each variable contributes to the model’s predictions:</p>
<div id="cell-136" class="cell">
<details class="code-fold">
<summary>Random Forest Feature Importance Script</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rif_feature_importance <span class="op">=</span> pd.Series(commuteRF.feature_importances_, index<span class="op">=</span>X_train.columns).sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>rif_feature_importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>distance                       0.416896
|_population_diff_|            0.088291
|_housing_growth_diff_|        0.074278
|_travel_time_diff_|           0.073151
|_median_weekly_pay_diff_|     0.068869
|_centrality_diff_|            0.065763
|_value_added_hourly_diff_|    0.058756
|_gcse_rate_diff_|             0.054705
|_emp_rate_diff_|              0.051680
|_life_satisfaction_diff_|     0.047610
dtype: float64</code></pre>
</div>
</div>
<p>Here, we can see that the most important variable is <code>'distance'</code> (0.4169), which is consistent with the OLS and SEM results. The other variables again include <code>'population_diff'</code> (0.0883) and <code>'housing_growth_diff'</code> (0.0743), consistent with the OLS and SEM results. However, <code>'travel_time_diff'</code> (0.0732) is now also included, and <code>'median_weekly_pay_diff'</code> (0.0689) is not materially more important than the added <code>'centrality'</code> variable (0.0658).</p>
<p>As discussed, Random Forest models are non-parametric, and hence, there is no additional information on concepts such as statistical significance, effect size, or direction of the relationship, in the scope of this method. Therefore, this is the extent of the inference.</p>
<p>And finally, permutation importance:</p>
<div id="cell-138" class="cell">
<details class="code-fold">
<summary>Random Forest Permutation Importance Script</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> permutation_importance(commuteRF, X_test, y_test,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                                 n_repeats<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                                 random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>rif_perm_importance <span class="op">=</span> pd.Series(result.importances_mean, index<span class="op">=</span>X_test.columns).sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>rif_perm_importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>distance                       0.680163
|_population_diff_|            0.156520
|_centrality_diff_|            0.038961
|_median_weekly_pay_diff_|     0.019008
|_emp_rate_diff_|              0.015234
|_travel_time_diff_|           0.012933
|_housing_growth_diff_|        0.011483
|_gcse_rate_diff_|             0.010611
|_life_satisfaction_diff_|    -0.000230
|_value_added_hourly_diff_|   -0.000486
dtype: float64</code></pre>
</div>
</div>
<p>The results are broadly consistent again, but <code>'centrality'</code> is more important than other metrics for the first time. Again, it is important to note that there is an element of randomness in the results, and therefore, they must be interpreted with caution.</p>
</section>
<section id="sec-conclusion" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Conclusion</h1>
<p>My research question asked:</p>
<h5 style="margin-top: 30px; margin-bottom: 30px; font-style: italic;" class="anchored">
“Which structural socioeconomic factors between regions most influence the relative popularity of commuting routes?”
</h5>
<p>I employed three models to address this question: OLS, SEM, and Random Forest. I used linear regressions as my primary method of analysis as the models tend to have the most inferential power, providing insight into importance, direction and effect size. However, the assumptions of linear regression may not be fully satisfied in this context, and therefore, I also employed a Random Forest model, which is more robust to violations of the assumptions. Other models were not used, as generally there is a trade-off between complexity and interpretability.</p>
<p>They key metrics used for inference were the coefficients of the OLS and SEM models, and the feature importance of the Random Forest model. I also used permutation importance across all, as it is a consistent metric across models, however due to the random elements, the confidence in their reults is lower. Other potential metrics such as Shapley values, were briefly mentioned, but not employed for simplicity of the task.</p>
<p>Results were generally consistent across the models. With high confidence, I can say that <code>'distance'</code> is the most important structural variable that determines the relative popularity of commuting routes, and this is consistent with the literature on the subject (So et al., 2001). This was verified across all model types and specifications, and in each case, <code>'distance'</code> was materially more important than the next best variable. In all regression models, the coefficient of <code>'distance'</code> was negative, indicating that as distance increases, the popularity of the route decreases, and the results were statistically significant at all confidence levels. However, the literature (So et al., 2001) also focuses heavily on commuting time, which is not included in this analysis and is likely to be heavily correlated with distance. This is a key limitation of the analysis, as it is not possible to separate variables like <code>'distance'</code> from related factors, and therefore inference is limited abnd/or biased by researcher design.</p>
<p><code>'population_diff'</code> was consistently the second most important variable across models (excluding the simple, pre-transformation OLS), and was statistically significant in all OLS and SEM models. These models showed that the larger the difference in the population, the higher the commuting flow’s relative popularity. This may reflect that larger populations by definiton have more people who can commute, leading to a higher commuting flow. It also may act as a proxy for other factors such as urban/rural splits, job density and many other socioeconomic factors.</p>
<p>Other consistently important variables included <code>'housing_growth_diff'</code> and <code>'median_weekly_pay_diff'</code>, where again, the greater the difference, the higher the relative popularity of the commuting flow. Importance rankings and significance varied across models, adding uncertainty to their interpretation. The former could be a lagging indicator of demand and, therefore, may be a proxy for other factors. The latter may reflect the economic trade-off associated with commuting.</p>
<p>Other variables did not consistently provide explanatory power for the relationship with commuting popularity, so I cannot draw any conclusions about their importance.</p>
<section id="references" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="references">References</h2>
<div id="refs" role="list">
<p>Ahrens, A., &amp; Lyons, S. (2021). Do rising rents lead to longer commutes? A gravity model of commuting flows in Ireland. Urban Studies, 58(2), 264–279. <a href="https://doi.org/10.1177/0042098020910698">https://doi.org/10.1177/0042098020910698</a></p>
<p>Buckmann, M., &amp; Joseph, A. (2022). An Interpretable Machine Learning Workflow with An Application to Economic Forecasting. SSRN Electronic Journal. <a href="https://doi.org/10.2139/ssrn.4130517">https://doi.org/10.2139/ssrn.4130517</a></p>
<p>Harris, R., Jarvis, C. (2011). Statistics for Geography and Environmental Science (First Edition). Prentice Hall.</p>
<p>Hincks, S., Kingston, R., Webb, B., &amp; Wong, C. (2018). A new geodemographic classification of commuting flows for England and Wales. International Journal of Geographical Information Science, 32(4), 663–684. <a href="https://doi.org/10.1080/13658816.2017.1407416">https://doi.org/10.1080/13658816.2017.1407416</a></p>
<p>So, K. S., Orazem, P. F., &amp; Otto, D. M. (2001). The Effects of Housing Prices, Wages, and Commuting Time on Joint Residential and Job Location Choices. American Journal of Agricultural Economics, 83(4), 1036–1048. <a href="https://doi.org/10.1111/0002-9092.00228">https://doi.org/10.1111/0002-9092.00228</a></p>
<p>Tranos, E., Gheasi, M., &amp; Nijkamp, P. (2015). International Migration: A Global Complex Network. Environment and Planning B: Planning and Design, 42(1), 4–22. <a href="https://doi.org/10.1068/b39042">https://doi.org/10.1068/b39042</a></p>
<p>Wander, M., &amp; Blumenberg, E. (2024). Is housing affordability associated with shorter commutes for low-income workers? <a href="https://doi.org/10.17610/T6Z32J">https://doi.org/10.17610/T6Z32J</a></p>
<p>Yeo, I.-K., &amp; Johnson, R. (2000). A new family of power transformations to improve normality or symmetry. Biometrika, 87(4), 954–959. <a href="https://doi.org/10.1093/biomet/87.4.954">https://doi.org/10.1093/biomet/87.4.954</a></p>
</div>
<hr>
</section>
</section>
<section id="sec-appendices" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Appendices</h1>
<section id="sec-setup" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="sec-setup"><span class="header-section-number">6.1</span> Appendix A: Setup</h2>
<section id="sec-environment" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="sec-environment"><span class="header-section-number">6.1.1</span> Environment</h3>
<p>This notebook was written in Python 3.9.18. The environment can be retrieved from the <a href="https://github.com/2601547/commute">Github project repo</a>.</p>
</section>
<section id="sec-packages" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="sec-packages"><span class="header-section-number">6.1.2</span> Packages</h3>
<div id="cell-150" class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.model_selection <span class="im">as</span> skm</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> esda.moran <span class="im">import</span> Moran</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libpysal.weights <span class="im">import</span> DistanceBand, KNN, lag_spatial</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> skew</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor <span class="im">as</span> RF</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> permutation_importance</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PowerTransformer, StandardScaler</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spreg <span class="im">import</span> GM_Error_Het, OLS</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="sec-eda" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="sec-eda"><span class="header-section-number">6.2</span> Appendix B: Exploratory Data Analysis</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Section Summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p>Cleaned the dataset by:</p>
<ul>
<li>Dropping routes missing values (“City of London” and “Isles of Scilly”)</li>
</ul></li>
<li><p>Add geographic information, including coordinates, using <code>geopandas</code></p>
<ul>
<li>Identified potential spatial autocorrelation</li>
</ul></li>
<li><p>Identified daily variation in <code>'journey_score'</code> for the same routes over time</p></li>
</ul>
</div>
</div>
</div>
<p>The following section addresses exploration of the provided dataset, focusing on:</p>
<ul>
<li>Understanding the data</li>
<li>Ensuring the data is clean and usable</li>
<li>Visualising the data to understand the context and distribution</li>
</ul>
<p>The LAcommute.csv file is loaded into a pandas dataframe and displayed:</p>
<div id="cell-155" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># relative file paths are used here as to not leak my name, although absolute paths may be better for reproducibility</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>base_data_dir <span class="op">=</span> os.path.abspath(<span class="st">'../../1. Data/LAcommute'</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>LAcommute <span class="op">=</span> pd.read_csv(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    os.path.join(base_data_dir, <span class="st">"LAcommute.csv"</span>), index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>LAcommute</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_code_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">area_code_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">gcse_rate_origin</th>
<th data-quarto-table-cell-role="th">life_satisfaction_origin</th>
<th data-quarto-table-cell-role="th">housing_growth_origin</th>
<th data-quarto-table-cell-role="th">value_added_hourly_dest</th>
<th data-quarto-table-cell-role="th">median_weekly_pay_dest</th>
<th data-quarto-table-cell-role="th">emp_rate_dest</th>
<th data-quarto-table-cell-role="th">travel_time_dest</th>
<th data-quarto-table-cell-role="th">gcse_rate_dest</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2019-01-01</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>1.4414</td>
<td>9</td>
<td>0.000000</td>
<td>92401</td>
<td>92401</td>
<td>...</td>
<td>67.6</td>
<td>7.33</td>
<td>161</td>
<td>28.31</td>
<td>487.40</td>
<td>67.1</td>
<td>12.9</td>
<td>67.6</td>
<td>7.33</td>
<td>161</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-01</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>County Durham</td>
<td>E06000047</td>
<td>-0.3129</td>
<td>3</td>
<td>37592.170378</td>
<td>92401</td>
<td>518562</td>
<td>...</td>
<td>67.6</td>
<td>7.33</td>
<td>161</td>
<td>28.96</td>
<td>469.40</td>
<td>71.4</td>
<td>14.1</td>
<td>67.6</td>
<td>7.43</td>
<td>1343</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>1.0253</td>
<td>10</td>
<td>0.000000</td>
<td>142134</td>
<td>142134</td>
<td>...</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
<td>29.30</td>
<td>420.80</td>
<td>65.6</td>
<td>15.4</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Redcar and Cleveland</td>
<td>E06000003</td>
<td>0.3086</td>
<td>7</td>
<td>13069.176565</td>
<td>142134</td>
<td>136699</td>
<td>...</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
<td>26.54</td>
<td>439.20</td>
<td>68.4</td>
<td>13.3</td>
<td>69.6</td>
<td>7.44</td>
<td>365</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Stockton-on-Tees</td>
<td>E06000004</td>
<td>0.3772</td>
<td>8</td>
<td>7379.212731</td>
<td>142134</td>
<td>196860</td>
<td>...</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
<td>34.37</td>
<td>469.40</td>
<td>74.8</td>
<td>13.2</td>
<td>69.5</td>
<td>7.40</td>
<td>616</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">316514</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Sutton</td>
<td>E09000029</td>
<td>-0.6732</td>
<td>4</td>
<td>16964.439602</td>
<td>208415</td>
<td>208516</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>35.19</td>
<td>565.80</td>
<td>77.4</td>
<td>9.0</td>
<td>82.0</td>
<td>7.36</td>
<td>313</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">316515</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Tower Hamlets</td>
<td>E09000030</td>
<td>1.3720</td>
<td>10</td>
<td>8616.142460</td>
<td>208415</td>
<td>305066</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>60.46</td>
<td>680.30</td>
<td>74.4</td>
<td>4.4</td>
<td>72.4</td>
<td>7.13</td>
<td>3248</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">316516</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Waltham Forest</td>
<td>E09000031</td>
<td>-0.4483</td>
<td>6</td>
<td>13672.865893</td>
<td>208415</td>
<td>281015</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>34.63</td>
<td>624.70</td>
<td>71.5</td>
<td>7.2</td>
<td>71.5</td>
<td>7.30</td>
<td>1263</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">316517</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Wandsworth</td>
<td>E09000032</td>
<td>0.1871</td>
<td>8</td>
<td>7117.584240</td>
<td>208415</td>
<td>334558</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>35.15</td>
<td>746.70</td>
<td>84.9</td>
<td>6.2</td>
<td>74.2</td>
<td>7.34</td>
<td>1415</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">316518</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Westminster</td>
<td>E09000033</td>
<td>1.6534</td>
<td>10</td>
<td>0.000000</td>
<td>208415</td>
<td>208415</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>52.46</td>
<td>771.60</td>
<td>67.2</td>
<td>5.1</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
</tr>
</tbody>
</table>

<p>316519 rows × 24 columns</p>
</div>
</div>
</div>
<p>The 316519 rows represent various commuting flow routes within and between different areas of the UK from 1 January 2019 to 31 December 2019. Routes are reported as pairs of areas, with the origin and destination columns indicating each route’s start and end points. Given the areas are reported as local authorities (LA), as per the area codes, and implied from the dataset title, this data is likely sourced from the Office for National Statistics (ONS).</p>
<p>The first row shows “Hartlepool” to “Hartlepool,” meaning there is both intra- and inter-LA commuting.</p>
<p>There are 24 columns, which are listed as:</p>
<div id="cell-157" class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>LAcommute.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>Index(['date', 'area_name_origin', 'area_code_origin', 'area_name_dest',
       'area_code_dest', 'journey_score', 'journey_count_decile', 'distance',
       'population_origin', 'population_dest', 'value_added_hourly_origin',
       'median_weekly_pay_origin', 'emp_rate_origin', 'travel_time_origin',
       'gcse_rate_origin', 'life_satisfaction_origin', 'housing_growth_origin',
       'value_added_hourly_dest', 'median_weekly_pay_dest', 'emp_rate_dest',
       'travel_time_dest', 'gcse_rate_dest', 'life_satisfaction_dest',
       'housing_growth_dest'],
      dtype='object')</code></pre>
</div>
</div>
<p>We can also see some additional information about the dataset using <code>describe()</code></p>
<div id="cell-159" class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>LAcommute.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">value_added_hourly_origin</th>
<th data-quarto-table-cell-role="th">travel_time_origin</th>
<th data-quarto-table-cell-role="th">housing_growth_origin</th>
<th data-quarto-table-cell-role="th">value_added_hourly_dest</th>
<th data-quarto-table-cell-role="th">travel_time_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>316519.000000</td>
<td>316519.000000</td>
<td>316519.000000</td>
<td>3.165190e+05</td>
<td>3.165190e+05</td>
<td>316519.000000</td>
<td>316519.000000</td>
<td>316519.000000</td>
<td>316519.000000</td>
<td>316519.000000</td>
<td>316519.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.519814</td>
<td>6.280928</td>
<td>13044.446197</td>
<td>2.840599e+05</td>
<td>2.878074e+05</td>
<td>39.152417</td>
<td>8.476279</td>
<td>1158.507954</td>
<td>38.540809</td>
<td>8.655166</td>
<td>1160.971885</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.996988</td>
<td>2.821859</td>
<td>10767.620494</td>
<td>1.393700e+05</td>
<td>1.347657e+05</td>
<td>9.230682</td>
<td>2.772127</td>
<td>870.434423</td>
<td>8.907160</td>
<td>2.693593</td>
<td>852.007444</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>-2.168800</td>
<td>1.000000</td>
<td>0.000000</td>
<td>2.098000e+03</td>
<td>2.098000e+03</td>
<td>23.790000</td>
<td>3.200000</td>
<td>0.000000</td>
<td>23.790000</td>
<td>3.200000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>-0.230050</td>
<td>4.000000</td>
<td>6993.581679</td>
<td>2.084150e+05</td>
<td>2.122450e+05</td>
<td>31.820000</td>
<td>6.200000</td>
<td>547.000000</td>
<td>31.270000</td>
<td>7.000000</td>
<td>551.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.464000</td>
<td>7.000000</td>
<td>11461.611507</td>
<td>2.789080e+05</td>
<td>2.810150e+05</td>
<td>36.820000</td>
<td>8.300000</td>
<td>969.000000</td>
<td>36.800000</td>
<td>8.400000</td>
<td>969.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1.172200</td>
<td>9.000000</td>
<td>17143.862769</td>
<td>3.311920e+05</td>
<td>3.345580e+05</td>
<td>46.140000</td>
<td>10.300000</td>
<td>1439.000000</td>
<td>45.240000</td>
<td>10.400000</td>
<td>1447.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>8.677600</td>
<td>10.000000</td>
<td>269291.080357</td>
<td>1.150646e+06</td>
<td>1.150646e+06</td>
<td>60.810000</td>
<td>44.300000</td>
<td>4024.000000</td>
<td>60.810000</td>
<td>44.300000</td>
<td>4024.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can see that <code>'journey_score,'</code> which will likely be the dependent variable, appears to have been standardised, i.e., a z-score is given for each pair. The mean is 0.5, close to the value of 0 you would expect, and the standard deviation is 1.0. The delta in the mean and 0 suggests that this may be a subset of a larger dataset that was standardised.</p>
<p>This also means that scores are relative, with scores of 0.5 and below reflecting a route that is less travelled than average and scores above 0.5 reflecting a more travelled route than average.</p>
<p>Further research identified that the original data source for this <code>'journey_score'</code> variable is from the <a href="https://data.cdrc.ac.uk/dataset/spectus-origin-destination-derived-mobility-data">CDRC</a> based on mobile GPS data. The <code>'journey_score'</code> variable is confirmed as a z-score, standardised over 2019 to 2022. This presents a significant issue for interpretation as the interpretation becomes more akin to:</p>
<p><em>“Holding other factors constant, a one-unit increase in the variable <code>'A'</code> is associated with a β change in the journey_score, measured in standard deviations relative to the 2019–2022 distribution”</em></p>
<p>Which may not be intuitive to interpret or meaningful in the context of the research question.</p>
<p>More information can be found <code>.info()</code></p>
<div id="cell-161" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>LAcommute.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 316519 entries, 0 to 316518
Data columns (total 24 columns):
 #   Column                     Non-Null Count   Dtype  
---  ------                     --------------   -----  
 0   date                       316519 non-null  object 
 1   area_name_origin           316519 non-null  object 
 2   area_code_origin           316519 non-null  object 
 3   area_name_dest             316519 non-null  object 
 4   area_code_dest             316519 non-null  object 
 5   journey_score              316519 non-null  float64
 6   journey_count_decile       316519 non-null  int64  
 7   distance                   316519 non-null  float64
 8   population_origin          316519 non-null  int64  
 9   population_dest            316519 non-null  int64  
 10  value_added_hourly_origin  316519 non-null  float64
 11  median_weekly_pay_origin   316519 non-null  object 
 12  emp_rate_origin            316519 non-null  object 
 13  travel_time_origin         316519 non-null  float64
 14  gcse_rate_origin           316519 non-null  object 
 15  life_satisfaction_origin   316519 non-null  object 
 16  housing_growth_origin      316519 non-null  int64  
 17  value_added_hourly_dest    316519 non-null  float64
 18  median_weekly_pay_dest     316519 non-null  object 
 19  emp_rate_dest              316519 non-null  object 
 20  travel_time_dest           316519 non-null  float64
 21  gcse_rate_dest             316519 non-null  object 
 22  life_satisfaction_dest     316519 non-null  object 
 23  housing_growth_dest        316519 non-null  int64  
dtypes: float64(6), int64(5), object(13)
memory usage: 60.4+ MB</code></pre>
</div>
</div>
<p>We also see that the data is not completely usable as provided due to inconsistent data types. For example, the column <code>'median_weekly_pay_origin'</code> is an object type with the incorrect storage style. This can be amended:</p>
<div id="cell-163" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>LAcommute.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>date                          object
area_name_origin              object
area_code_origin              object
area_name_dest                object
area_code_dest                object
journey_score                float64
journey_count_decile           int64
distance                     float64
population_origin              int64
population_dest                int64
value_added_hourly_origin    float64
median_weekly_pay_origin      object
emp_rate_origin               object
travel_time_origin           float64
gcse_rate_origin              object
life_satisfaction_origin      object
housing_growth_origin          int64
value_added_hourly_dest      float64
median_weekly_pay_dest        object
emp_rate_dest                 object
travel_time_dest             float64
gcse_rate_dest                object
life_satisfaction_dest        object
housing_growth_dest            int64
dtype: object</code></pre>
</div>
</div>
<div id="cell-164" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>LAcommute[<span class="st">'date'</span>] <span class="op">=</span> LAcommute[<span class="st">'date'</span>].<span class="bu">apply</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    pd.to_datetime, <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>other_columns <span class="op">=</span> [<span class="st">'emp_rate_origin'</span>, <span class="st">'emp_rate_dest'</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'median_weekly_pay_origin'</span>, <span class="st">'median_weekly_pay_dest'</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'gcse_rate_origin'</span>, <span class="st">'gcse_rate_dest'</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'life_satisfaction_origin'</span>, <span class="st">'life_satisfaction_dest'</span>,]</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>LAcommute[other_columns] <span class="op">=</span> LAcommute[other_columns].<span class="bu">apply</span>(</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>LAcommute.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>date                         datetime64[ns]
area_name_origin                     object
area_code_origin                     object
area_name_dest                       object
area_code_dest                       object
journey_score                       float64
journey_count_decile                  int64
distance                            float64
population_origin                     int64
population_dest                       int64
value_added_hourly_origin           float64
median_weekly_pay_origin            float64
emp_rate_origin                     float64
travel_time_origin                  float64
gcse_rate_origin                    float64
life_satisfaction_origin            float64
housing_growth_origin                 int64
value_added_hourly_dest             float64
median_weekly_pay_dest              float64
emp_rate_dest                       float64
travel_time_dest                    float64
gcse_rate_dest                      float64
life_satisfaction_dest              float64
housing_growth_dest                   int64
dtype: object</code></pre>
</div>
</div>
<p>We can then check for missing values and or duplicates:</p>
<div id="cell-166" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> LAcommute.isnull().values.<span class="bu">any</span>():</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Missing values found"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No missing values"</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> LAcommute[LAcommute.duplicated()].empty:</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No duplicates"</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Duplicates found"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Missing values found
No duplicates</code></pre>
</div>
</div>
<p>Although there are no duplicates, we can see some missing values. We can see the number of missing values in each column using:</p>
<div id="cell-168" class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>missing_values <span class="op">=</span> LAcommute.isnull().<span class="bu">sum</span>()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>missing_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>date                            0
area_name_origin                0
area_code_origin                0
area_name_dest                  0
area_code_dest                  0
journey_score                   0
journey_count_decile            0
distance                        0
population_origin               0
population_dest                 0
value_added_hourly_origin       0
median_weekly_pay_origin     9599
emp_rate_origin              9599
travel_time_origin              0
gcse_rate_origin             9586
life_satisfaction_origin     9599
housing_growth_origin           0
value_added_hourly_dest         0
median_weekly_pay_dest       6271
emp_rate_dest                6271
travel_time_dest                0
gcse_rate_dest               6258
life_satisfaction_dest       6271
housing_growth_dest             0
dtype: int64</code></pre>
</div>
</div>
<p>That is a significant amount of missing values, so it is important to determine what is going on and following that, how to deal with them. We can see that they are not random, they are only for <code>'median_weekly_pay'</code>, <code>'emp_rate'</code>, <code>'gcse_rate'</code> and <code>'life_satisfaction'</code>.</p>
<div id="cell-170" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>missing_values_rows <span class="op">=</span> LAcommute[LAcommute.isnull().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)]</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>missing_values_rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_code_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">area_code_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">gcse_rate_origin</th>
<th data-quarto-table-cell-role="th">life_satisfaction_origin</th>
<th data-quarto-table-cell-role="th">housing_growth_origin</th>
<th data-quarto-table-cell-role="th">value_added_hourly_dest</th>
<th data-quarto-table-cell-role="th">median_weekly_pay_dest</th>
<th data-quarto-table-cell-role="th">emp_rate_dest</th>
<th data-quarto-table-cell-role="th">travel_time_dest</th>
<th data-quarto-table-cell-role="th">gcse_rate_dest</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">294</td>
<td>2019-01-01</td>
<td>City of London</td>
<td>E09000001</td>
<td>City of London</td>
<td>E09000001</td>
<td>-0.3374</td>
<td>10</td>
<td>0.000000</td>
<td>8765</td>
<td>8765</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
<td>57.01</td>
<td>NaN</td>
<td>NaN</td>
<td>7.9</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">295</td>
<td>2019-01-01</td>
<td>City of London</td>
<td>E09000001</td>
<td>Barking and Dagenham</td>
<td>E09000002</td>
<td>-1.3314</td>
<td>2</td>
<td>16110.974505</td>
<td>8765</td>
<td>218828</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
<td>36.89</td>
<td>523.5</td>
<td>67.3</td>
<td>8.4</td>
<td>68.0</td>
<td>7.35</td>
<td>1048</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">296</td>
<td>2019-01-01</td>
<td>City of London</td>
<td>E09000001</td>
<td>Brent</td>
<td>E09000005</td>
<td>-1.1846</td>
<td>2</td>
<td>13051.679464</td>
<td>8765</td>
<td>347424</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
<td>36.82</td>
<td>553.1</td>
<td>70.4</td>
<td>7.5</td>
<td>71.5</td>
<td>7.25</td>
<td>2404</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">297</td>
<td>2019-01-01</td>
<td>City of London</td>
<td>E09000001</td>
<td>Camden</td>
<td>E09000007</td>
<td>-0.7811</td>
<td>6</td>
<td>5850.378829</td>
<td>8765</td>
<td>217136</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
<td>51.32</td>
<td>694.2</td>
<td>69.6</td>
<td>5.7</td>
<td>72.3</td>
<td>6.78</td>
<td>509</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">298</td>
<td>2019-01-01</td>
<td>City of London</td>
<td>E09000001</td>
<td>Hackney</td>
<td>E09000012</td>
<td>-0.8153</td>
<td>5</td>
<td>4665.516680</td>
<td>8765</td>
<td>265825</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
<td>36.06</td>
<td>575.1</td>
<td>72.5</td>
<td>4.8</td>
<td>72.0</td>
<td>6.94</td>
<td>969</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">316393</td>
<td>2019-12-31</td>
<td>Newham</td>
<td>E09000025</td>
<td>City of London</td>
<td>E09000001</td>
<td>0.3497</td>
<td>6</td>
<td>9090.106893</td>
<td>349786</td>
<td>8765</td>
<td>...</td>
<td>70.7</td>
<td>7.51</td>
<td>1813</td>
<td>57.01</td>
<td>NaN</td>
<td>NaN</td>
<td>7.9</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">316422</td>
<td>2019-12-31</td>
<td>Southwark</td>
<td>E09000028</td>
<td>City of London</td>
<td>E09000001</td>
<td>1.4381</td>
<td>9</td>
<td>4597.455204</td>
<td>312591</td>
<td>8765</td>
<td>...</td>
<td>71.0</td>
<td>7.17</td>
<td>1096</td>
<td>57.01</td>
<td>NaN</td>
<td>NaN</td>
<td>7.9</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">316448</td>
<td>2019-12-31</td>
<td>Tower Hamlets</td>
<td>E09000030</td>
<td>City of London</td>
<td>E09000001</td>
<td>0.5614</td>
<td>9</td>
<td>3961.057843</td>
<td>305066</td>
<td>8765</td>
<td>...</td>
<td>72.4</td>
<td>7.13</td>
<td>3248</td>
<td>57.01</td>
<td>NaN</td>
<td>NaN</td>
<td>7.9</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">316464</td>
<td>2019-12-31</td>
<td>Waltham Forest</td>
<td>E09000031</td>
<td>City of London</td>
<td>E09000001</td>
<td>-1.0617</td>
<td>1</td>
<td>10581.867402</td>
<td>281015</td>
<td>8765</td>
<td>...</td>
<td>71.5</td>
<td>7.30</td>
<td>1263</td>
<td>57.01</td>
<td>NaN</td>
<td>NaN</td>
<td>7.9</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">316489</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>City of London</td>
<td>E09000001</td>
<td>2.0080</td>
<td>10</td>
<td>4660.462296</td>
<td>208415</td>
<td>8765</td>
<td>...</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>57.01</td>
<td>NaN</td>
<td>NaN</td>
<td>7.9</td>
<td>NaN</td>
<td>NaN</td>
<td>206</td>
</tr>
</tbody>
</table>

<p>15492 rows × 24 columns</p>
</div>
</div>
</div>
<p>Since all rows appear to have the commonality of “City of London”, we can assume this is the source of the missing value. This is consistent with the implication that this is ONS data, as the City of London tends to be excluded from datasets due to its unique nature and small population.</p>
<p>It is simple to remove these rows, as they are likely irrelevant to the analysis.</p>
<div id="cell-172" class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>LAcommute <span class="op">=</span> LAcommute[</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    (LAcommute[<span class="st">'area_name_origin'</span>] <span class="op">!=</span> <span class="st">'City of London'</span>) <span class="op">&amp;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    (LAcommute[<span class="st">'area_name_dest'</span>] <span class="op">!=</span> <span class="st">'City of London'</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can once again check for missing values…</p>
<div id="cell-174" class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>missing_values <span class="op">=</span> LAcommute.isnull().<span class="bu">sum</span>()</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>missing_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>date                          0
area_name_origin              0
area_code_origin              0
area_name_dest                0
area_code_dest                0
journey_score                 0
journey_count_decile          0
distance                      0
population_origin             0
population_dest               0
value_added_hourly_origin     0
median_weekly_pay_origin     13
emp_rate_origin              13
travel_time_origin            0
gcse_rate_origin              0
life_satisfaction_origin     13
housing_growth_origin         0
value_added_hourly_dest       0
median_weekly_pay_dest       13
emp_rate_dest                13
travel_time_dest              0
gcse_rate_dest                0
life_satisfaction_dest       13
housing_growth_dest           0
dtype: int64</code></pre>
</div>
</div>
<p>However it appears that there are still some missing values in the dataset.</p>
<div id="cell-176" class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>missing_values_rows <span class="op">=</span> LAcommute[LAcommute.isnull().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)]</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>missing_values_rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_code_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">area_code_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">gcse_rate_origin</th>
<th data-quarto-table-cell-role="th">life_satisfaction_origin</th>
<th data-quarto-table-cell-role="th">housing_growth_origin</th>
<th data-quarto-table-cell-role="th">value_added_hourly_dest</th>
<th data-quarto-table-cell-role="th">median_weekly_pay_dest</th>
<th data-quarto-table-cell-role="th">emp_rate_dest</th>
<th data-quarto-table-cell-role="th">travel_time_dest</th>
<th data-quarto-table-cell-role="th">gcse_rate_dest</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">123116</td>
<td>2019-05-04</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>0.7176</td>
<td>2</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">124824</td>
<td>2019-05-06</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>-0.6279</td>
<td>1</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">200539</td>
<td>2019-08-07</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>2.0631</td>
<td>2</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">201407</td>
<td>2019-08-08</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>2.0631</td>
<td>2</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">202255</td>
<td>2019-08-09</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>-0.6279</td>
<td>1</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">208769</td>
<td>2019-08-17</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>-0.6279</td>
<td>1</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">211118</td>
<td>2019-08-20</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>0.7176</td>
<td>2</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">216123</td>
<td>2019-08-26</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>-0.6279</td>
<td>1</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">216842</td>
<td>2019-08-27</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>-0.6279</td>
<td>1</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">221053</td>
<td>2019-09-01</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>-0.6279</td>
<td>1</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">224334</td>
<td>2019-09-05</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>0.7176</td>
<td>2</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">226828</td>
<td>2019-09-08</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>-0.6279</td>
<td>1</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">231037</td>
<td>2019-09-13</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>Isles of Scilly</td>
<td>E06000053</td>
<td>-0.6279</td>
<td>1</td>
<td>0.0</td>
<td>2098</td>
<td>2098</td>
<td>...</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
<td>39.28</td>
<td>NaN</td>
<td>NaN</td>
<td>44.3</td>
<td>89.5</td>
<td>NaN</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>13 rows × 24 columns</p>
</div>
</div>
</div>
<p>…which this time appears to be “Isles of Scilly”. We remove these too, noting it looks like all “Isles of Scilly” routes are to the “Isles of Scilly”.</p>
<div id="cell-178" class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>LAcommute <span class="op">=</span> LAcommute[</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    (LAcommute[<span class="st">'area_name_origin'</span>] <span class="op">!=</span> <span class="st">'Isles of Scilly'</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-179" class="cell">
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>date                         0
area_name_origin             0
area_code_origin             0
area_name_dest               0
area_code_dest               0
journey_score                0
journey_count_decile         0
distance                     0
population_origin            0
population_dest              0
value_added_hourly_origin    0
median_weekly_pay_origin     0
emp_rate_origin              0
travel_time_origin           0
gcse_rate_origin             0
life_satisfaction_origin     0
housing_growth_origin        0
value_added_hourly_dest      0
median_weekly_pay_dest       0
emp_rate_dest                0
travel_time_dest             0
gcse_rate_dest               0
life_satisfaction_dest       0
housing_growth_dest          0
dtype: int64</code></pre>
</div>
</div>
<p>It may be helpful to get a sense of where the routes are, as this will determine the scope of the analysis. First, we can list the unique local authorities in the dataset:</p>
<div id="cell-181" class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>LA_count <span class="op">=</span> LAcommute[<span class="st">'area_name_origin'</span>].nunique()</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>LA_count</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>119</code></pre>
</div>
</div>
<p>There are 119 LAs in the dataset, following the removal of the City of London and Isles of Scilly. To contexutalise we this can be plotted on map.</p>
<p>The coordinates for the LA can be found in the <a href="https://geoportal.statistics.gov.uk/datasets/9cb3c710143649499ff6acaca927d205_0/explore">government depo</a>, and is downloaded as the file <code>"LAD_Dec_2019_Boundaries_UK_BFC_2022_-5126023737554987305.csv"</code>.</p>
<div id="cell-183" class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>LA_coordinates <span class="op">=</span> pd.read_csv(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    os.path.join(base_data_dir, <span class="st">"LAD_Dec_2019_Boundaries_UK_BFC_2022_-5126023737554987305.csv"</span>), index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>LA_coordinates.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">objectid</th>
<th data-quarto-table-cell-role="th">lad19cd</th>
<th data-quarto-table-cell-role="th">lad19nm</th>
<th data-quarto-table-cell-role="th">lad19nmw</th>
<th data-quarto-table-cell-role="th">bng_e</th>
<th data-quarto-table-cell-role="th">bng_n</th>
<th data-quarto-table-cell-role="th">long</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">st_areasha</th>
<th data-quarto-table-cell-role="th">st_lengths</th>
<th data-quarto-table-cell-role="th">Shape__Area</th>
<th data-quarto-table-cell-role="th">Shape__Length</th>
<th data-quarto-table-cell-role="th">GlobalID</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">FID</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>E06000001</td>
<td>Hartlepool</td>
<td></td>
<td>447160</td>
<td>531474</td>
<td>-1.27018</td>
<td>54.676140</td>
<td>9.371262e+07</td>
<td>71011.933949</td>
<td>2.797890e+08</td>
<td>122680.152623</td>
<td>d3127426-63c8-4358-a554-b3fe4f0e537e</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>E06000002</td>
<td>Middlesbrough</td>
<td></td>
<td>451141</td>
<td>516887</td>
<td>-1.21099</td>
<td>54.544670</td>
<td>5.388156e+07</td>
<td>44481.691242</td>
<td>1.598722e+08</td>
<td>76614.777246</td>
<td>7caac8a1-a10b-4878-a2ab-4fdb80e987a4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>E06000003</td>
<td>Redcar and Cleveland</td>
<td></td>
<td>464361</td>
<td>519597</td>
<td>-1.00608</td>
<td>54.567520</td>
<td>2.450695e+08</td>
<td>96703.989701</td>
<td>7.274510e+08</td>
<td>166599.724875</td>
<td>96cc264b-6155-48cb-8fc0-7e41684d2682</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>E06000004</td>
<td>Stockton-on-Tees</td>
<td></td>
<td>444940</td>
<td>518183</td>
<td>-1.30664</td>
<td>54.556911</td>
<td>2.049330e+08</td>
<td>123408.985928</td>
<td>6.086362e+08</td>
<td>212698.045558</td>
<td>051ae100-c81d-4cc1-989b-b65e71a9b942</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>5</td>
<td>E06000005</td>
<td>Darlington</td>
<td></td>
<td>428029</td>
<td>515648</td>
<td>-1.56835</td>
<td>54.535339</td>
<td>1.974757e+08</td>
<td>107206.401677</td>
<td>5.861353e+08</td>
<td>184666.724022</td>
<td>c22c366b-0133-4b9a-8376-013e0c43d6f2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The coordinates are then added to the dataframe…</p>
<div id="cell-185" class="cell">
<details class="code-fold">
<summary>Coordinates Merging Function</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_coordinates(df, coordinates, merge_col, prefix):</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.merge(</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>        coordinates[[<span class="st">'lad19nm'</span>, <span class="st">'lat'</span>, <span class="st">'long'</span>]],</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>        left_on<span class="op">=</span>merge_col,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>        right_on<span class="op">=</span><span class="st">'lad19nm'</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>{</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'lat'</span>: <span class="ss">f'lat_</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'long'</span>: <span class="ss">f'long_</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.drop(columns<span class="op">=</span>[<span class="st">'lad19nm'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-186" class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>LAcommute <span class="op">=</span> merge_coordinates(LAcommute, LA_coordinates, <span class="st">'area_name_origin'</span>, <span class="st">'origin'</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>LAcommute <span class="op">=</span> merge_coordinates(LAcommute, LA_coordinates, <span class="st">'area_name_dest'</span>, <span class="st">'dest'</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>LAcommute</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_code_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">area_code_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">median_weekly_pay_dest</th>
<th data-quarto-table-cell-role="th">emp_rate_dest</th>
<th data-quarto-table-cell-role="th">travel_time_dest</th>
<th data-quarto-table-cell-role="th">gcse_rate_dest</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
<th data-quarto-table-cell-role="th">lat_origin</th>
<th data-quarto-table-cell-role="th">long_origin</th>
<th data-quarto-table-cell-role="th">lat_dest</th>
<th data-quarto-table-cell-role="th">long_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2019-01-01</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>1.4414</td>
<td>9</td>
<td>0.000000</td>
<td>92401</td>
<td>92401</td>
<td>...</td>
<td>487.4</td>
<td>67.1</td>
<td>12.9</td>
<td>67.6</td>
<td>7.33</td>
<td>161</td>
<td>54.676140</td>
<td>-1.27018</td>
<td>54.676140</td>
<td>-1.27018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-01</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>County Durham</td>
<td>E06000047</td>
<td>-0.3129</td>
<td>3</td>
<td>37592.170378</td>
<td>92401</td>
<td>518562</td>
<td>...</td>
<td>469.4</td>
<td>71.4</td>
<td>14.1</td>
<td>67.6</td>
<td>7.43</td>
<td>1343</td>
<td>54.676140</td>
<td>-1.27018</td>
<td>54.685131</td>
<td>-1.84050</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>1.0253</td>
<td>10</td>
<td>0.000000</td>
<td>142134</td>
<td>142134</td>
<td>...</td>
<td>420.8</td>
<td>65.6</td>
<td>15.4</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
<td>54.544670</td>
<td>-1.21099</td>
<td>54.544670</td>
<td>-1.21099</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Redcar and Cleveland</td>
<td>E06000003</td>
<td>0.3086</td>
<td>7</td>
<td>13069.176565</td>
<td>142134</td>
<td>136699</td>
<td>...</td>
<td>439.2</td>
<td>68.4</td>
<td>13.3</td>
<td>69.6</td>
<td>7.44</td>
<td>365</td>
<td>54.544670</td>
<td>-1.21099</td>
<td>54.567520</td>
<td>-1.00608</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Stockton-on-Tees</td>
<td>E06000004</td>
<td>0.3772</td>
<td>8</td>
<td>7379.212731</td>
<td>142134</td>
<td>196860</td>
<td>...</td>
<td>469.4</td>
<td>74.8</td>
<td>13.2</td>
<td>69.5</td>
<td>7.40</td>
<td>616</td>
<td>54.544670</td>
<td>-1.21099</td>
<td>54.556911</td>
<td>-1.30664</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">301022</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Sutton</td>
<td>E09000029</td>
<td>-0.6732</td>
<td>4</td>
<td>16964.439602</td>
<td>208415</td>
<td>208516</td>
<td>...</td>
<td>565.8</td>
<td>77.4</td>
<td>9.0</td>
<td>82.0</td>
<td>7.36</td>
<td>313</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.357559</td>
<td>-0.17227</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">301023</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Tower Hamlets</td>
<td>E09000030</td>
<td>1.3720</td>
<td>10</td>
<td>8616.142460</td>
<td>208415</td>
<td>305066</td>
<td>...</td>
<td>680.3</td>
<td>74.4</td>
<td>4.4</td>
<td>72.4</td>
<td>7.13</td>
<td>3248</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.515541</td>
<td>-0.03643</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">301024</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Waltham Forest</td>
<td>E09000031</td>
<td>-0.4483</td>
<td>6</td>
<td>13672.865893</td>
<td>208415</td>
<td>281015</td>
<td>...</td>
<td>624.7</td>
<td>71.5</td>
<td>7.2</td>
<td>71.5</td>
<td>7.30</td>
<td>1263</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.594608</td>
<td>-0.01881</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">301025</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Wandsworth</td>
<td>E09000032</td>
<td>0.1871</td>
<td>8</td>
<td>7117.584240</td>
<td>208415</td>
<td>334558</td>
<td>...</td>
<td>746.7</td>
<td>84.9</td>
<td>6.2</td>
<td>74.2</td>
<td>7.34</td>
<td>1415</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.452400</td>
<td>-0.20023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">301026</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Westminster</td>
<td>E09000033</td>
<td>1.6534</td>
<td>10</td>
<td>0.000000</td>
<td>208415</td>
<td>208415</td>
<td>...</td>
<td>771.6</td>
<td>67.2</td>
<td>5.1</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.512199</td>
<td>-0.15295</td>
</tr>
</tbody>
</table>

<p>301027 rows × 28 columns</p>
</div>
</div>
</div>
<p>And then the dataframe is converted to a geodataframe:</p>
<div id="cell-188" class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>LAcommute_geo <span class="op">=</span> LAcommute <span class="co"># a gdf with two geometries is difficult to save, so for the appendices I will use this temporarily and in the main recreate a seperate LAcommuute gdf</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>LAcommute_geo[<span class="st">'geometry_origin'</span>] <span class="op">=</span> gpd.points_from_xy(</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    LAcommute_geo[<span class="st">'long_origin'</span>], LAcommute_geo[<span class="st">'lat_origin'</span>]</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>LAcommute_geo[<span class="st">'geometry_dest'</span>] <span class="op">=</span> gpd.points_from_xy(</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    LAcommute_geo[<span class="st">'long_dest'</span>], LAcommute_geo[<span class="st">'lat_dest'</span>]</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>LAcommute_geo <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    LAcommute_geo,</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span><span class="st">'geometry_origin'</span>,  <span class="co"># although I have added both geometries, for simlplicity I will only use the origin geometry for now</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span><span class="st">'EPSG:4326'</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>LAcommute_geo <span class="op">=</span> LAcommute_geo.drop(columns<span class="op">=</span>[<span class="st">'lat_origin'</span>, <span class="st">'long_origin'</span>, <span class="st">'lat_dest'</span>, <span class="st">'long_dest'</span>])</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>LAcommute_geo.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_code_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">area_code_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">housing_growth_origin</th>
<th data-quarto-table-cell-role="th">value_added_hourly_dest</th>
<th data-quarto-table-cell-role="th">median_weekly_pay_dest</th>
<th data-quarto-table-cell-role="th">emp_rate_dest</th>
<th data-quarto-table-cell-role="th">travel_time_dest</th>
<th data-quarto-table-cell-role="th">gcse_rate_dest</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
<th data-quarto-table-cell-role="th">geometry_origin</th>
<th data-quarto-table-cell-role="th">geometry_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2019-01-01</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>1.4414</td>
<td>9</td>
<td>0.000000</td>
<td>92401</td>
<td>92401</td>
<td>...</td>
<td>161</td>
<td>28.31</td>
<td>487.4</td>
<td>67.1</td>
<td>12.9</td>
<td>67.6</td>
<td>7.33</td>
<td>161</td>
<td>POINT (-1.27018 54.67614)</td>
<td>POINT (-1.27018 54.67614)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-01</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>County Durham</td>
<td>E06000047</td>
<td>-0.3129</td>
<td>3</td>
<td>37592.170378</td>
<td>92401</td>
<td>518562</td>
<td>...</td>
<td>161</td>
<td>28.96</td>
<td>469.4</td>
<td>71.4</td>
<td>14.1</td>
<td>67.6</td>
<td>7.43</td>
<td>1343</td>
<td>POINT (-1.27018 54.67614)</td>
<td>POINT (-1.84050 54.68513)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>1.0253</td>
<td>10</td>
<td>0.000000</td>
<td>142134</td>
<td>142134</td>
<td>...</td>
<td>456</td>
<td>29.30</td>
<td>420.8</td>
<td>65.6</td>
<td>15.4</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
<td>POINT (-1.21099 54.54467)</td>
<td>POINT (-1.21099 54.54467)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Redcar and Cleveland</td>
<td>E06000003</td>
<td>0.3086</td>
<td>7</td>
<td>13069.176565</td>
<td>142134</td>
<td>136699</td>
<td>...</td>
<td>456</td>
<td>26.54</td>
<td>439.2</td>
<td>68.4</td>
<td>13.3</td>
<td>69.6</td>
<td>7.44</td>
<td>365</td>
<td>POINT (-1.21099 54.54467)</td>
<td>POINT (-1.00608 54.56752)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Stockton-on-Tees</td>
<td>E06000004</td>
<td>0.3772</td>
<td>8</td>
<td>7379.212731</td>
<td>142134</td>
<td>196860</td>
<td>...</td>
<td>456</td>
<td>34.37</td>
<td>469.4</td>
<td>74.8</td>
<td>13.2</td>
<td>69.5</td>
<td>7.40</td>
<td>616</td>
<td>POINT (-1.21099 54.54467)</td>
<td>POINT (-1.30664 54.55691)</td>
</tr>
</tbody>
</table>

<p>5 rows × 26 columns</p>
</div>
</div>
</div>
<p>and now this can be plotted on a map:</p>
<div id="cell-fig-geo" class="cell">
<details class="code-fold">
<summary>Map Visualisation Script</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the is reprojected (from EPSG:4326) to EPSG:3857</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>LAcommute_geo <span class="op">=</span> LAcommute_geo.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">18</span>))</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>LAcommute_geo.plot(ax<span class="op">=</span>ax, alpha<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'red'</span>, markersize<span class="op">=</span><span class="dv">25</span>, edgecolor<span class="op">=</span><span class="st">'k'</span>,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>               label<span class="op">=</span><span class="st">'Local Authority (LA)'</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># an OpenStreetView basemap is added using contextily</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>ax.legend(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-geo" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-geo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-geo-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;2: Geographic location of LAs on a map of the UK"><img src="index_files/figure-html/fig-geo-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-geo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Geographic location of LAs on a map of the UK
</figcaption>
</figure>
</div>
</div>
</div>
<p>We can see a few things that need to be considered, as the dataset is:</p>
<ul>
<li>Restricted to England LAs</li>
<li>Incomplete for England, excluding key areas such as Cheltenham, Exeter and Oxford. This could introduce sample selection bias</li>
<li>Heavily skewed towards the South East and London (although this may reflect real-world commuting patterns)</li>
</ul>
<p>If we look take a look a random subsample of routes…</p>
<div id="cell-fig-random_routes_score" class="cell">
<details class="code-fold">
<summary>Plotting Function</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>unique_routes <span class="op">=</span> LAcommute[[<span class="st">'area_name_origin'</span>,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'area_name_dest'</span>]].drop_duplicates()</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>random_routes <span class="op">=</span> unique_routes.sample(n<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>plotting_routes <span class="op">=</span> LAcommute.merge(</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    random_routes,</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">'area_name_origin'</span>, <span class="st">'area_name_dest'</span>]</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>plotting_routes[<span class="st">'route'</span>] <span class="op">=</span> plotting_routes[<span class="st">'area_name_origin'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">' to '</span> <span class="op">+</span> plotting_routes[<span class="st">'area_name_dest'</span>]</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>plotting_routes, x<span class="op">=</span><span class="st">'date'</span>, y<span class="op">=</span><span class="st">'journey_score'</span>, hue<span class="op">=</span><span class="st">'route'</span>)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Journey Score'</span>)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Journey Score Over Time for Selected Routes'</span>)</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Route'</span>)</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-random_routes_score" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-random_routes_score-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-random_routes_score-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;3: Line graph of journey scores for random routes"><img src="index_files/figure-html/fig-random_routes_score-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-random_routes_score-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Line graph of journey scores for random routes
</figcaption>
</figure>
</div>
</div>
</div>
<p>And with <code>'journey_count_decile'</code>:</p>
<div id="cell-fig-random_routes_deciles" class="cell">
<details class="code-fold">
<summary>Plotting Function</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>unique_routes <span class="op">=</span> LAcommute[[<span class="st">'area_name_origin'</span>,</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'area_name_dest'</span>]].drop_duplicates()</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>random_routes <span class="op">=</span> unique_routes.sample(n<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>plotting_routes <span class="op">=</span> LAcommute.merge(</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    random_routes,</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">'area_name_origin'</span>, <span class="st">'area_name_dest'</span>]</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>plotting_routes[<span class="st">'route'</span>] <span class="op">=</span> plotting_routes[<span class="st">'area_name_origin'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">' to '</span> <span class="op">+</span> plotting_routes[<span class="st">'area_name_dest'</span>]</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>plotting_routes, x<span class="op">=</span><span class="st">'date'</span>, y<span class="op">=</span><span class="st">'journey_count_decile'</span>, hue<span class="op">=</span><span class="st">'route'</span>)</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Journey Count Decile'</span>)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Journey Count Decile Over Time for Selected Routes'</span>)</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Route'</span>, loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-random_routes_deciles" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-random_routes_deciles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-random_routes_deciles-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;4: Line graph of journey count decile for random routes"><img src="index_files/figure-html/fig-random_routes_deciles-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-random_routes_deciles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Line graph of journey count decile for random routes
</figcaption>
</figure>
</div>
</div>
</div>
<p>A few important things can be deduced about the wider dataset:</p>
<ul>
<li>There is significant variation in the <code>'journey_score,'</code> i.e.&nbsp;som,e routes becoming both more and less popular over time &nbsp; - There is less variation in the <code>'jouney_count_decile'</code> variable, which is likely a result of the aggregation process &nbsp; - This will be critical for inferential design/feature selection, as the provided dataset suggested independent variables are all “point in time” rather than time series data</li>
<li>The routes are not constant over time, or there is data missing &nbsp; &nbsp;- This is shown via “Brent” to “Central Bedfordshire”, which does not show any data in December 2019</li>
<li>There are some irregularities, such as the “Brent” route flatlining, which could be a result of data collection/input errors</li>
</ul>
<p>To get a bit more insight, we can look at the means:</p>
<div id="cell-197" class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> LAcommute.groupby([<span class="st">'area_name_origin'</span>, <span class="st">'area_name_dest'</span>])[<span class="st">'journey_score'</span>].mean()</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>route_means <span class="op">=</span> <span class="bu">round</span>(means,<span class="dv">3</span>).reset_index()</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>route_means.columns <span class="op">=</span> [<span class="st">'area_name_origin'</span>, <span class="st">'area_name_dest'</span>, <span class="st">'mean_journey_score'</span>]</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>route_means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">mean_journey_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Barking and Dagenham</td>
<td>Barking and Dagenham</td>
<td>1.155</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Barking and Dagenham</td>
<td>Brent</td>
<td>0.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Barking and Dagenham</td>
<td>Camden</td>
<td>0.010</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Barking and Dagenham</td>
<td>Enfield</td>
<td>0.016</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Barking and Dagenham</td>
<td>Greenwich</td>
<td>0.030</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1388</td>
<td>Wolverhampton</td>
<td>Wolverhampton</td>
<td>1.190</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1389</td>
<td>York</td>
<td>East Riding of Yorkshire</td>
<td>0.148</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1390</td>
<td>York</td>
<td>Leeds</td>
<td>0.161</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1391</td>
<td>York</td>
<td>Wakefield</td>
<td>0.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1392</td>
<td>York</td>
<td>York</td>
<td>1.200</td>
</tr>
</tbody>
</table>

<p>1393 rows × 3 columns</p>
</div>
</div>
</div>
<p>This shows the dataset is not standardised across routes, i.e.&nbsp;not reflecting relative popularity over time of the same route</p>
<p>From here on, information may be relevant to the analysis, so the file will be saved and renamed “LAcommute_clean.csv.”</p>
<p>Geographical data will be dropped as it will be added later, where relevant for feature additions rather than exploratory data analysis.</p>
<div id="cell-200" class="cell">
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_code_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">area_code_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">travel_time_dest</th>
<th data-quarto-table-cell-role="th">gcse_rate_dest</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
<th data-quarto-table-cell-role="th">lat_origin</th>
<th data-quarto-table-cell-role="th">long_origin</th>
<th data-quarto-table-cell-role="th">lat_dest</th>
<th data-quarto-table-cell-role="th">long_dest</th>
<th data-quarto-table-cell-role="th">geometry_origin</th>
<th data-quarto-table-cell-role="th">geometry_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2019-01-01</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>1.4414</td>
<td>9</td>
<td>0.000000</td>
<td>92401</td>
<td>92401</td>
<td>...</td>
<td>12.9</td>
<td>67.6</td>
<td>7.33</td>
<td>161</td>
<td>54.676140</td>
<td>-1.27018</td>
<td>54.676140</td>
<td>-1.27018</td>
<td>POINT (-1.27018 54.67614)</td>
<td>POINT (-1.27018 54.67614)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-01</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>County Durham</td>
<td>E06000047</td>
<td>-0.3129</td>
<td>3</td>
<td>37592.170378</td>
<td>92401</td>
<td>518562</td>
<td>...</td>
<td>14.1</td>
<td>67.6</td>
<td>7.43</td>
<td>1343</td>
<td>54.676140</td>
<td>-1.27018</td>
<td>54.685131</td>
<td>-1.84050</td>
<td>POINT (-1.27018 54.67614)</td>
<td>POINT (-1.84050 54.68513)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>1.0253</td>
<td>10</td>
<td>0.000000</td>
<td>142134</td>
<td>142134</td>
<td>...</td>
<td>15.4</td>
<td>63.2</td>
<td>7.21</td>
<td>456</td>
<td>54.544670</td>
<td>-1.21099</td>
<td>54.544670</td>
<td>-1.21099</td>
<td>POINT (-1.21099 54.54467)</td>
<td>POINT (-1.21099 54.54467)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Redcar and Cleveland</td>
<td>E06000003</td>
<td>0.3086</td>
<td>7</td>
<td>13069.176565</td>
<td>142134</td>
<td>136699</td>
<td>...</td>
<td>13.3</td>
<td>69.6</td>
<td>7.44</td>
<td>365</td>
<td>54.544670</td>
<td>-1.21099</td>
<td>54.567520</td>
<td>-1.00608</td>
<td>POINT (-1.21099 54.54467)</td>
<td>POINT (-1.00608 54.56752)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2019-01-01</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Stockton-on-Tees</td>
<td>E06000004</td>
<td>0.3772</td>
<td>8</td>
<td>7379.212731</td>
<td>142134</td>
<td>196860</td>
<td>...</td>
<td>13.2</td>
<td>69.5</td>
<td>7.40</td>
<td>616</td>
<td>54.544670</td>
<td>-1.21099</td>
<td>54.556911</td>
<td>-1.30664</td>
<td>POINT (-1.21099 54.54467)</td>
<td>POINT (-1.30664 54.55691)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">301022</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Sutton</td>
<td>E09000029</td>
<td>-0.6732</td>
<td>4</td>
<td>16964.439602</td>
<td>208415</td>
<td>208516</td>
<td>...</td>
<td>9.0</td>
<td>82.0</td>
<td>7.36</td>
<td>313</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.357559</td>
<td>-0.17227</td>
<td>POINT (-0.15295 51.51220)</td>
<td>POINT (-0.17227 51.35756)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">301023</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Tower Hamlets</td>
<td>E09000030</td>
<td>1.3720</td>
<td>10</td>
<td>8616.142460</td>
<td>208415</td>
<td>305066</td>
<td>...</td>
<td>4.4</td>
<td>72.4</td>
<td>7.13</td>
<td>3248</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.515541</td>
<td>-0.03643</td>
<td>POINT (-0.15295 51.51220)</td>
<td>POINT (-0.03643 51.51554)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">301024</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Waltham Forest</td>
<td>E09000031</td>
<td>-0.4483</td>
<td>6</td>
<td>13672.865893</td>
<td>208415</td>
<td>281015</td>
<td>...</td>
<td>7.2</td>
<td>71.5</td>
<td>7.30</td>
<td>1263</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.594608</td>
<td>-0.01881</td>
<td>POINT (-0.15295 51.51220)</td>
<td>POINT (-0.01881 51.59461)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">301025</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Wandsworth</td>
<td>E09000032</td>
<td>0.1871</td>
<td>8</td>
<td>7117.584240</td>
<td>208415</td>
<td>334558</td>
<td>...</td>
<td>6.2</td>
<td>74.2</td>
<td>7.34</td>
<td>1415</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.452400</td>
<td>-0.20023</td>
<td>POINT (-0.15295 51.51220)</td>
<td>POINT (-0.20023 51.45240)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">301026</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Westminster</td>
<td>E09000033</td>
<td>1.6534</td>
<td>10</td>
<td>0.000000</td>
<td>208415</td>
<td>208415</td>
<td>...</td>
<td>5.1</td>
<td>77.3</td>
<td>7.21</td>
<td>580</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>POINT (-0.15295 51.51220)</td>
<td>POINT (-0.15295 51.51220)</td>
</tr>
</tbody>
</table>

<p>301027 rows × 30 columns</p>
</div>
</div>
</div>
<div id="cell-201" class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>LAcommute <span class="op">=</span> LAcommute.drop(columns<span class="op">=</span>[</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'lat_origin'</span>, <span class="st">'long_origin'</span>, <span class="st">'lat_dest'</span>, <span class="st">'long_dest'</span>, <span class="st">'geometry_origin'</span>, <span class="st">'geometry_dest'</span>])</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>LAcommute.to_csv(</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    os.path.join(base_data_dir, <span class="st">"LAcommute_clean.csv"</span>), index<span class="op">=</span><span class="va">True</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-centrality-appendix" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="sec-centrality-appendix"><span class="header-section-number">6.3</span> Appendix C: Centrality</h2>
<p>Exploring centrality using network graphs:</p>
<p>I will look at degree centrality for undirected networks, i.e.&nbsp;who has the most connections in terms of the number of links per node, although there are other measures of centrality.</p>
<div id="cell-205" class="cell" data-execution_count="85">
<div class="cell-output cell-output-display" data-execution_count="85">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">area_name_origin</th>
<th data-quarto-table-cell-role="th">area_code_origin</th>
<th data-quarto-table-cell-role="th">area_name_dest</th>
<th data-quarto-table-cell-role="th">area_code_dest</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">population_origin</th>
<th data-quarto-table-cell-role="th">population_dest</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">median_weekly_pay_dest</th>
<th data-quarto-table-cell-role="th">emp_rate_dest</th>
<th data-quarto-table-cell-role="th">travel_time_dest</th>
<th data-quarto-table-cell-role="th">gcse_rate_dest</th>
<th data-quarto-table-cell-role="th">life_satisfaction_dest</th>
<th data-quarto-table-cell-role="th">housing_growth_dest</th>
<th data-quarto-table-cell-role="th">lat_origin</th>
<th data-quarto-table-cell-role="th">long_origin</th>
<th data-quarto-table-cell-role="th">lat_dest</th>
<th data-quarto-table-cell-role="th">long_dest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2019-01-02</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>Stockton-on-Tees</td>
<td>E06000004</td>
<td>1.5423</td>
<td>5</td>
<td>12951.008041</td>
<td>92401</td>
<td>196860</td>
<td>...</td>
<td>469.4</td>
<td>74.8</td>
<td>13.2</td>
<td>69.5</td>
<td>7.40</td>
<td>616</td>
<td>54.676140</td>
<td>-1.27018</td>
<td>54.556911</td>
<td>-1.30664</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-02</td>
<td>Hartlepool</td>
<td>E06000001</td>
<td>County Durham</td>
<td>E06000047</td>
<td>1.5683</td>
<td>5</td>
<td>37592.170378</td>
<td>92401</td>
<td>518562</td>
<td>...</td>
<td>469.4</td>
<td>71.4</td>
<td>14.1</td>
<td>67.6</td>
<td>7.43</td>
<td>1343</td>
<td>54.676140</td>
<td>-1.27018</td>
<td>54.685131</td>
<td>-1.84050</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2019-01-02</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Redcar and Cleveland</td>
<td>E06000003</td>
<td>0.9239</td>
<td>8</td>
<td>13069.176565</td>
<td>142134</td>
<td>136699</td>
<td>...</td>
<td>439.2</td>
<td>68.4</td>
<td>13.3</td>
<td>69.6</td>
<td>7.44</td>
<td>365</td>
<td>54.544670</td>
<td>-1.21099</td>
<td>54.567520</td>
<td>-1.00608</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2019-01-02</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>Stockton-on-Tees</td>
<td>E06000004</td>
<td>1.8569</td>
<td>9</td>
<td>7379.212731</td>
<td>142134</td>
<td>196860</td>
<td>...</td>
<td>469.4</td>
<td>74.8</td>
<td>13.2</td>
<td>69.5</td>
<td>7.40</td>
<td>616</td>
<td>54.544670</td>
<td>-1.21099</td>
<td>54.556911</td>
<td>-1.30664</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2019-01-02</td>
<td>Middlesbrough</td>
<td>E06000002</td>
<td>County Durham</td>
<td>E06000047</td>
<td>-1.0400</td>
<td>1</td>
<td>43441.543055</td>
<td>142134</td>
<td>518562</td>
<td>...</td>
<td>469.4</td>
<td>71.4</td>
<td>14.1</td>
<td>67.6</td>
<td>7.43</td>
<td>1343</td>
<td>54.544670</td>
<td>-1.21099</td>
<td>54.685131</td>
<td>-1.84050</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188229</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Southwark</td>
<td>E09000028</td>
<td>1.0626</td>
<td>10</td>
<td>7319.207505</td>
<td>208415</td>
<td>312591</td>
<td>...</td>
<td>631.9</td>
<td>79.4</td>
<td>6.1</td>
<td>71.0</td>
<td>7.17</td>
<td>1096</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.465919</td>
<td>-0.07306</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188230</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Sutton</td>
<td>E09000029</td>
<td>-0.6732</td>
<td>4</td>
<td>16964.439602</td>
<td>208415</td>
<td>208516</td>
<td>...</td>
<td>565.8</td>
<td>77.4</td>
<td>9.0</td>
<td>82.0</td>
<td>7.36</td>
<td>313</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.357559</td>
<td>-0.17227</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188231</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Tower Hamlets</td>
<td>E09000030</td>
<td>1.3720</td>
<td>10</td>
<td>8616.142460</td>
<td>208415</td>
<td>305066</td>
<td>...</td>
<td>680.3</td>
<td>74.4</td>
<td>4.4</td>
<td>72.4</td>
<td>7.13</td>
<td>3248</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.515541</td>
<td>-0.03643</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188232</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Waltham Forest</td>
<td>E09000031</td>
<td>-0.4483</td>
<td>6</td>
<td>13672.865893</td>
<td>208415</td>
<td>281015</td>
<td>...</td>
<td>624.7</td>
<td>71.5</td>
<td>7.2</td>
<td>71.5</td>
<td>7.30</td>
<td>1263</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.594608</td>
<td>-0.01881</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">188233</td>
<td>2019-12-31</td>
<td>Westminster</td>
<td>E09000033</td>
<td>Wandsworth</td>
<td>E09000032</td>
<td>0.1871</td>
<td>8</td>
<td>7117.584240</td>
<td>208415</td>
<td>334558</td>
<td>...</td>
<td>746.7</td>
<td>84.9</td>
<td>6.2</td>
<td>74.2</td>
<td>7.34</td>
<td>1415</td>
<td>51.512199</td>
<td>-0.15295</td>
<td>51.452400</td>
<td>-0.20023</td>
</tr>
</tbody>
</table>

<p>188234 rows × 28 columns</p>
</div>
</div>
</div>
<div id="cell-206" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> commute_centr.iterrows():</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    G.add_edge(row[<span class="st">'area_name_origin'</span>], row[<span class="st">'area_name_dest'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-fig-centr" class="cell">
<details class="code-fold">
<summary>Network Visualisation Script</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">24</span>, <span class="dv">24</span>))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> nx.circular_layout(G)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>nx.draw(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    G, pos, with_labels<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    node_size<span class="op">=</span><span class="dv">500</span>, node_color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    edge_color<span class="op">=</span><span class="st">'gray'</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node, (x, y) <span class="kw">in</span> pos.items():</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    angle <span class="op">=</span> np.arctan2(y, x)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    rotation <span class="op">=</span> np.degrees(angle)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>        rotation <span class="op">+=</span> <span class="dv">180</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    plt.text(</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>        x, y, node,</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>        fontsize<span class="op">=</span><span class="dv">13</span>, color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>        ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>        rotation<span class="op">=</span>rotation, rotation_mode<span class="op">=</span><span class="st">'anchor'</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Network Graph of Commuting Routes'</span>, fontsize<span class="op">=</span><span class="dv">28</span>)</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-centr" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-centr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-centr-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;5: Network Graph of Commuting Routes"><img src="index_files/figure-html/fig-centr-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-centr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Network Graph of Commuting Routes
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-data-diagnostics" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="sec-data-diagnostics"><span class="header-section-number">6.4</span> Appendix D: Data Diagnostics</h2>
<div id="cell-210" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>commute_trans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pairs</th>
<th data-quarto-table-cell-role="th">journey_score</th>
<th data-quarto-table-cell-role="th">journey_count_decile</th>
<th data-quarto-table-cell-role="th">distance</th>
<th data-quarto-table-cell-role="th">|_population_diff_|</th>
<th data-quarto-table-cell-role="th">|_value_added_hourly_diff_|</th>
<th data-quarto-table-cell-role="th">|_median_weekly_pay_diff_|</th>
<th data-quarto-table-cell-role="th">|_emp_rate_diff_|</th>
<th data-quarto-table-cell-role="th">|_travel_time_diff_|</th>
<th data-quarto-table-cell-role="th">|_gcse_rate_diff_|</th>
<th data-quarto-table-cell-role="th">|_life_satisfaction_diff_|</th>
<th data-quarto-table-cell-role="th">|_housing_growth_diff_|</th>
<th data-quarto-table-cell-role="th">|_avg_monthly_rent_diff_|</th>
<th data-quarto-table-cell-role="th">|_centrality_diff_|</th>
<th data-quarto-table-cell-role="th">route_midpoint_(geo)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Barking and Dagenham - Barnet</td>
<td>-0.010609</td>
<td>1.363636</td>
<td>25056.274464</td>
<td>171762</td>
<td>0.09</td>
<td>51.4</td>
<td>8.3</td>
<td>0.9</td>
<td>13.4</td>
<td>0.05</td>
<td>1202</td>
<td>150.0</td>
<td>0.017241</td>
<td>POINT (-0.04437 51.57832)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Barking and Dagenham - Brent</td>
<td>-0.397323</td>
<td>1.291667</td>
<td>27881.522854</td>
<td>128596</td>
<td>0.07</td>
<td>29.6</td>
<td>3.1</td>
<td>0.9</td>
<td>3.5</td>
<td>0.10</td>
<td>1356</td>
<td>252.0</td>
<td>0.068966</td>
<td>POINT (-0.07310 51.55498)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Barking and Dagenham - Camden</td>
<td>0.112844</td>
<td>2.959443</td>
<td>20345.000863</td>
<td>1692</td>
<td>14.43</td>
<td>170.7</td>
<td>2.3</td>
<td>2.7</td>
<td>4.3</td>
<td>0.57</td>
<td>539</td>
<td>858.0</td>
<td>0.146552</td>
<td>POINT (-0.01671 51.54431)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Barking and Dagenham - Enfield</td>
<td>-0.004368</td>
<td>2.500977</td>
<td>19482.245346</td>
<td>116323</td>
<td>5.36</td>
<td>15.6</td>
<td>2.5</td>
<td>0.1</td>
<td>0.7</td>
<td>0.49</td>
<td>251</td>
<td>50.0</td>
<td>0.000000</td>
<td>POINT (0.02400 51.59722)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Barking and Dagenham - Greenwich</td>
<td>0.114385</td>
<td>2.973163</td>
<td>9642.046411</td>
<td>69377</td>
<td>1.56</td>
<td>95.4</td>
<td>8.3</td>
<td>0.0</td>
<td>0.8</td>
<td>0.13</td>
<td>6</td>
<td>150.0</td>
<td>0.051724</td>
<td>POINT (0.08979 51.50474)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">672</td>
<td>West Berkshire - Wokingham</td>
<td>0.163863</td>
<td>2.844894</td>
<td>29259.923429</td>
<td>10906</td>
<td>4.18</td>
<td>64.6</td>
<td>5.8</td>
<td>1.6</td>
<td>5.6</td>
<td>0.01</td>
<td>512</td>
<td>175.0</td>
<td>0.008621</td>
<td>POINT (-1.08649 51.43427)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">673</td>
<td>Westminster - Wiltshire</td>
<td>0.075996</td>
<td>1.931034</td>
<td>126401.984988</td>
<td>294570</td>
<td>21.88</td>
<td>290.4</td>
<td>10.8</td>
<td>9.5</td>
<td>4.9</td>
<td>0.29</td>
<td>2266</td>
<td>1633.0</td>
<td>0.344828</td>
<td>POINT (-1.03978 51.42052)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">674</td>
<td>Westminster - Windsor and Maidenhead</td>
<td>0.026557</td>
<td>2.449654</td>
<td>37615.785116</td>
<td>54522</td>
<td>0.44</td>
<td>164.8</td>
<td>11.9</td>
<td>4.6</td>
<td>0.8</td>
<td>0.29</td>
<td>270</td>
<td>1183.0</td>
<td>0.318966</td>
<td>POINT (-0.41418 51.49627)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">675</td>
<td>Westminster - Wokingham</td>
<td>-0.168467</td>
<td>1.416667</td>
<td>51144.513300</td>
<td>36626</td>
<td>4.76</td>
<td>113.0</td>
<td>10.0</td>
<td>6.8</td>
<td>3.1</td>
<td>0.12</td>
<td>549</td>
<td>1283.0</td>
<td>0.344828</td>
<td>POINT (-0.52615 51.46758)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">676</td>
<td>Windsor and Maidenhead - Wokingham</td>
<td>0.161748</td>
<td>2.881737</td>
<td>14209.316238</td>
<td>17896</td>
<td>5.20</td>
<td>51.8</td>
<td>1.9</td>
<td>2.2</td>
<td>2.3</td>
<td>0.17</td>
<td>819</td>
<td>100.0</td>
<td>0.025862</td>
<td>POINT (-0.78738 51.45165)</td>
</tr>
</tbody>
</table>

<p>677 rows × 15 columns</p>
</div>
</div>
</div>
<p>To assess potential concerns in the data that might require transformations, we can use histogram visualisations, scatter plots and statistical tests:</p>
<div id="cell-fig-histogram" class="cell" data-execution_count="91">
<details class="code-fold">
<summary>Plotting Function</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="op">=</span> commute_trans.select_dtypes(</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    include<span class="op">=</span>[<span class="st">'float64'</span>, <span class="st">'int64'</span>]).columns</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>n_cols <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>n_rows <span class="op">=</span> (<span class="bu">len</span>(numeric_cols) <span class="op">+</span> n_cols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> n_cols</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">15</span>, n_rows <span class="op">*</span> <span class="dv">5</span>))</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> [<span class="st">'#69b3a2'</span>]</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">'darkgrid'</span>)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, col <span class="kw">in</span> <span class="bu">enumerate</span>(numeric_cols):</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    sns.histplot(commute_trans[col], kde<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span>palette[<span class="dv">0</span>], bins<span class="op">=</span><span class="dv">30</span>, ax<span class="op">=</span>axes[i])</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(<span class="ss">f'Distribution of </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xlabel(col)</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(numeric_cols), <span class="bu">len</span>(axes)):</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[j])</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-histogram" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-histogram-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure&nbsp;6: Histogram of distribution of commute data"><img src="index_files/figure-html/fig-histogram-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Histogram of distribution of commute data
</figcaption>
</figure>
</div>
</div>
</div>
<p>Almost all variables are rightly skewed which could be a concern for OLS, as it violates assumptions of normality.</p>
<div id="cell-fig-boxplot" class="cell" data-execution_count="92">
<details class="code-fold">
<summary>Plotting Function</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">15</span>, n_rows <span class="op">*</span> <span class="dv">5</span>))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> [<span class="st">'#ffb347'</span>]</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">'darkgrid'</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, col <span class="kw">in</span> <span class="bu">enumerate</span>(numeric_cols):</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(y<span class="op">=</span>commute_trans[col], color<span class="op">=</span>palette[<span class="dv">0</span>], ax<span class="op">=</span>axes[i])</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(<span class="ss">f'Box Plot of </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xlabel(<span class="st">''</span>)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(col)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(numeric_cols), <span class="bu">len</span>(axes)):</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[j])</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-boxplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-boxplot-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure&nbsp;7: Box plot of distribution of commute data"><img src="index_files/figure-html/fig-boxplot-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Box plot of distribution of commute data
</figcaption>
</figure>
</div>
</div>
</div>
<p>In addition we can look at the relationship between <code>'journey_score'</code> and the other variables to assess linearity. This is important for OLS, as it assumes a linear relationship between the dependent and independent variables:</p>
<div id="cell-fig-scatterplot" class="cell" data-execution_count="93">
<details class="code-fold">
<summary>Plotting Function</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>y_sp <span class="op">=</span> <span class="st">'journey_score'</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>X_sp <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> numeric_cols <span class="cf">if</span> col <span class="op">!=</span> y_sp]</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(n_rows, n_cols, figsize<span class="op">=</span>(<span class="dv">15</span>, n_rows <span class="op">*</span> <span class="dv">5</span>))</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> [<span class="st">'#ff6961'</span>]</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">'darkgrid'</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, col <span class="kw">in</span> <span class="bu">enumerate</span>(X_sp):</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    sns.scatterplot(</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>commute_trans[col], y<span class="op">=</span>commute_trans[y_sp], color<span class="op">=</span>palette[<span class="dv">0</span>], ax<span class="op">=</span>axes[i])</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> vs </span><span class="sc">{</span>y_sp<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xlabel(col)</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(y_sp)</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(X_sp), <span class="bu">len</span>(axes)):</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>    fig.delaxes(axes[j])</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-scatterplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-scatterplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="index_files/figure-html/fig-scatterplot-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;8: Scatterplot of distribution of commute data"><img src="index_files/figure-html/fig-scatterplot-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-scatterplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Scatterplot of distribution of commute data
</figcaption>
</figure>
</div>
</div>
</div>
<p>… the concerns around non-linearity are confirmed by the scatter plot all plots show show variance of <code>'journey_score'</code> increasing with X. This therefore violates a key OLS assumption.</p>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{2025,
  author = {, 2601547},
  title = {What Drives Commuting Decisions?},
  date = {2025-05-02},
  langid = {en},
  abstract = {This study answers, “which structural socio-economic
    factors between regions most influence the relative popularity of
    commuting routes?” This question is important as transport policy,
    development planning and wider government initiatives such as the
    “Levelling Up” agenda are all influenced by commuting patterns. The
    analysis uses a dataset of commuting flows between local authorities
    in England. It employs statistical and machine learning techniques
    (such as OLS, SEM and Random Forest) to identify the most
    significant factors influencing commuting decisions. The study finds
    that across all methods, distance is the most important factor
    influencing commuting flows, generally followed by population,
    median pay and housing growth differences between local authorities.
    The study also finds that the relative importance of these factors
    varies by region, with spatial aspects playing a key role in the
    influence of different factors.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-2025" class="csl-entry quarto-appendix-citeas" role="listitem">
2601547. 2025. <span>“What Drives Commuting Decisions?”</span>
GEOGM0053: Data Science and Machine Learning. May 2, 2025.
</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>